using System.Collections;
using System.Linq;
using WowPacketParser.Enums;
using WowPacketParser.Misc;
using WowPacketParser.Parsing.Parsers;
using WowPacketParser.Store.Objects.UpdateFields;

// This file is automatically generated, DO NOT EDIT

namespace WowPacketParserModule.V2_5_1_38707.UpdateFields.V2_5_4_42800
{
    public class UpdateFieldHandler : UpdateFieldsHandlerBase
    {
        public override IObjectData ReadCreateObjectData(Packet packet, UpdateFieldFlag flags, params object[] indexes)
        {
            var data = new ObjectData();
            data.EntryID = packet.ReadInt32("EntryID", indexes);
            data.DynamicFlags = packet.ReadUInt32("DynamicFlags", indexes);
            data.Scale = packet.ReadSingle("Scale", indexes);
            return data;
        }

        public override IObjectData ReadUpdateObjectData(Packet packet, params object[] indexes)
        {
            var data = new ObjectData();
            var rawChangesMask = new int[1];
            rawChangesMask[0] = (int)packet.ReadBits(4);
            var changesMask = new BitArray(rawChangesMask);

            packet.ResetBitReader();
            if (changesMask[0])
            {
                if (changesMask[1])
                {
                    data.EntryID = packet.ReadInt32("EntryID", indexes);
                }
                if (changesMask[2])
                {
                    data.DynamicFlags = packet.ReadUInt32("DynamicFlags", indexes);
                }
                if (changesMask[3])
                {
                    data.Scale = packet.ReadSingle("Scale", indexes);
                }
            }
            return data;
        }

        public static IItemEnchantment ReadCreateItemEnchantment(Packet packet, params object[] indexes)
        {
            var data = new ItemEnchantment();
            data.ID = packet.ReadInt32("ID", indexes);
            data.Duration = packet.ReadUInt32("Duration", indexes);
            data.Charges = packet.ReadInt16("Charges", indexes);
            data.Unk254 = packet.ReadByte("Unk254", indexes);
            data.Unk254_2 = packet.ReadByte("Unk254_2", indexes);
            return data;
        }

        public static IItemEnchantment ReadUpdateItemEnchantment(Packet packet, params object[] indexes)
        {
            var data = new ItemEnchantment();
            var rawChangesMask = new int[1];
            rawChangesMask[0] = (int)packet.ReadBits(6);
            var changesMask = new BitArray(rawChangesMask);

            packet.ResetBitReader();
            if (changesMask[0])
            {
                if (changesMask[1])
                {
                    data.ID = packet.ReadInt32("ID", indexes);
                }
                if (changesMask[2])
                {
                    data.Duration = packet.ReadUInt32("Duration", indexes);
                }
                if (changesMask[3])
                {
                    data.Charges = packet.ReadInt16("Charges", indexes);
                }
                if (changesMask[4])
                {
                    data.Unk254 = packet.ReadByte("Unk254", indexes);
                }
                if (changesMask[5])
                {
                    data.Unk254_2 = packet.ReadByte("Unk254_2", indexes);
                }
            }
            return data;
        }

        public static IItemMod ReadCreateItemMod(Packet packet, params object[] indexes)
        {
            var data = new ItemMod();
            data.Value = packet.ReadInt32("Value", indexes);
            data.Type = packet.ReadByte("Type", indexes);
            return data;
        }

        public static IItemMod ReadUpdateItemMod(Packet packet, params object[] indexes)
        {
            var data = new ItemMod();
            data.Value = packet.ReadInt32("Value", indexes);
            data.Type = packet.ReadByte("Type", indexes);
            return data;
        }

        public static IItemModList ReadCreateItemModList(Packet packet, params object[] indexes)
        {
            var data = new ItemModList();
            packet.ResetBitReader();
            data.Values.Resize(packet.ReadBits(6));
            for (var i = 0; i < data.Values.Count; ++i)
            {
                data.Values[i] = ReadCreateItemMod(packet, indexes, "Values", i);
            }
            return data;
        }

        public static IItemModList ReadUpdateItemModList(Packet packet, params object[] indexes)
        {
            var data = new ItemModList();
            packet.ResetBitReader();
            var rawChangesMask = new int[1];
            rawChangesMask[0] = (int)packet.ReadBits(1);
            var changesMask = new BitArray(rawChangesMask);

            if (changesMask[0])
            {
                if (changesMask[0])
                {
                    data.Values.ReadUpdateMask(packet, 6);
                }
            }
            packet.ResetBitReader();
            if (changesMask[0])
            {
                if (changesMask[0])
                {
                    for (var i = 0; i < data.Values.Count; ++i)
                    {
                        if (data.Values.UpdateMask[i])
                        {
                            data.Values[i] = ReadUpdateItemMod(packet, data.Values[i] as ItemMod, indexes, "Values", i);
                        }
                    }
                }
            }
            return data;
        }

        public static IArtifactPower ReadCreateArtifactPower(Packet packet, params object[] indexes)
        {
            var data = new ArtifactPower();
            data.ArtifactPowerID = packet.ReadInt16("ArtifactPowerID", indexes);
            data.PurchasedRank = packet.ReadByte("PurchasedRank", indexes);
            data.CurrentRankWithBonus = packet.ReadByte("CurrentRankWithBonus", indexes);
            return data;
        }

        public static IArtifactPower ReadUpdateArtifactPower(Packet packet, params object[] indexes)
        {
            var data = new ArtifactPower();
            data.ArtifactPowerID = packet.ReadInt16("ArtifactPowerID", indexes);
            data.PurchasedRank = packet.ReadByte("PurchasedRank", indexes);
            data.CurrentRankWithBonus = packet.ReadByte("CurrentRankWithBonus", indexes);
            return data;
        }

        public static ISocketedGem ReadCreateSocketedGem(Packet packet, params object[] indexes)
        {
            var data = new SocketedGem();
            data.ItemID = packet.ReadInt32("ItemID", indexes);
            for (var i = 0; i < 16; ++i)
            {
                data.BonusListIDs[i] = packet.ReadUInt16("BonusListIDs", indexes, i);
            }
            data.Context = packet.ReadByte("Context", indexes);
            return data;
        }

        public static ISocketedGem ReadUpdateSocketedGem(Packet packet, params object[] indexes)
        {
            var data = new SocketedGem();
            var rawChangesMask = new int[1];
            var rawMaskMask = new int[1];
            rawMaskMask[0] = (int)packet.ReadBits(1);
            var maskMask = new BitArray(rawMaskMask);
            if (maskMask[0])
                rawChangesMask[0] = (int)packet.ReadBits(32);
            var changesMask = new BitArray(rawChangesMask);

            packet.ResetBitReader();
            if (changesMask[0])
            {
                if (changesMask[1])
                {
                    data.ItemID = packet.ReadInt32("ItemID", indexes);
                }
                if (changesMask[2])
                {
                    data.Context = packet.ReadByte("Context", indexes);
                }
            }
            if (changesMask[3])
            {
                for (var i = 0; i < 16; ++i)
                {
                    if (changesMask[4 + i])
                    {
                        data.BonusListIDs[i] = packet.ReadUInt16("BonusListIDs", indexes, i);
                    }
                }
            }
            return data;
        }

        public override IItemData ReadCreateItemData(Packet packet, UpdateFieldFlag flags, params object[] indexes)
        {
            var data = new ItemData();
            data.BonusListIDs = new System.Nullable<int>[packet.ReadUInt32()];
            for (var i = 0; i < data.BonusListIDs.Length; ++i)
            {
                data.BonusListIDs[i] = packet.ReadInt32("BonusListIDs", indexes, i);
            }
            data.Owner = packet.ReadPackedGuid128("Owner", indexes);
            data.ContainedIn = packet.ReadPackedGuid128("ContainedIn", indexes);
            data.Creator = packet.ReadPackedGuid128("Creator", indexes);
            data.GiftCreator = packet.ReadPackedGuid128("GiftCreator", indexes);
            if ((flags & UpdateFieldFlag.Owner) != UpdateFieldFlag.None)
            {
                data.StackCount = packet.ReadUInt32("StackCount", indexes);
                data.Expiration = packet.ReadUInt32("Expiration", indexes);
                for (var i = 0; i < 5; ++i)
                {
                    data.SpellCharges[i] = packet.ReadInt32("SpellCharges", indexes, i);
                }
            }
            data.DynamicFlags = packet.ReadUInt32("DynamicFlags", indexes);
            for (var i = 0; i < 13; ++i)
            {
                data.Enchantment[i] = ReadCreateItemEnchantment(packet, indexes, "Enchantment", i);
            }
            data.PropertySeed = packet.ReadInt32("PropertySeed", indexes);
            data.RandomPropertiesID = packet.ReadInt32("RandomPropertiesID", indexes);
            if ((flags & UpdateFieldFlag.Owner) != UpdateFieldFlag.None)
            {
                data.Durability = packet.ReadUInt32("Durability", indexes);
                data.MaxDurability = packet.ReadUInt32("MaxDurability", indexes);
            }
            data.CreatePlayedTime = packet.ReadUInt32("CreatePlayedTime", indexes);
            data.Context = packet.ReadInt32("Context", indexes);
            data.CreateTime = packet.ReadInt64("CreateTime", indexes);
            if ((flags & UpdateFieldFlag.Owner) != UpdateFieldFlag.None)
            {
                data.ArtifactXP = packet.ReadUInt64("ArtifactXP", indexes);
                data.ItemAppearanceModID = packet.ReadByte("ItemAppearanceModID", indexes);
            }
            data.ArtifactPowers.Resize(packet.ReadUInt32());
            data.Gems.Resize(packet.ReadUInt32());
            if ((flags & UpdateFieldFlag.Owner) != UpdateFieldFlag.None)
            {
                data.DynamicFlags2 = packet.ReadUInt32("DynamicFlags2", indexes);
            }
            for (var i = 0; i < data.ArtifactPowers.Count; ++i)
            {
                data.ArtifactPowers[i] = ReadCreateArtifactPower(packet, indexes, "ArtifactPowers", i);
            }
            for (var i = 0; i < data.Gems.Count; ++i)
            {
                data.Gems[i] = ReadCreateSocketedGem(packet, indexes, "Gems", i);
            }
            data.Modifiers = ReadCreateItemModList(packet, indexes, "Modifiers");
            return data;
        }

        public override IItemData ReadUpdateItemData(Packet packet, params object[] indexes)
        {
            var data = new ItemData();
            var rawChangesMask = new int[2];
            var rawMaskMask = new int[1];
            rawMaskMask[0] = (int)packet.ReadBits(2);
            var maskMask = new BitArray(rawMaskMask);
            for (var i = 0; i < 2; ++i)
                if (maskMask[i])
                    rawChangesMask[i] = (int)packet.ReadBits(32);
            var changesMask = new BitArray(rawChangesMask);

            if (changesMask[0])
            {
                if (changesMask[1])
                {
                    data.BonusListIDs = Enumerable.Range(0, (int)packet.ReadBits(32)).Select(x => new int()).Cast<System.Nullable<int>>().ToArray();
                    for (var i = 0; i < data.BonusListIDs.Length; ++i)
                    {
                        data.BonusListIDs[i] = packet.ReadInt32("BonusListIDs", indexes, i);
                    }
                }
            }
            packet.ResetBitReader();
            if (changesMask[0])
            {
                if (changesMask[2])
                {
                    data.ArtifactPowers.ReadUpdateMask(packet);
                }
                if (changesMask[3])
                {
                    data.Gems.ReadUpdateMask(packet);
                }
            }
            packet.ResetBitReader();
            if (changesMask[0])
            {
                if (changesMask[2])
                {
                    for (var i = 0; i < data.ArtifactPowers.Count; ++i)
                    {
                        if (data.ArtifactPowers.UpdateMask[i])
                        {
                            data.ArtifactPowers[i] = ReadUpdateArtifactPower(packet, data.ArtifactPowers[i] as ArtifactPower, indexes, "ArtifactPowers", i);
                        }
                    }
                }
                if (changesMask[3])
                {
                    for (var i = 0; i < data.Gems.Count; ++i)
                    {
                        if (data.Gems.UpdateMask[i])
                        {
                            data.Gems[i] = ReadUpdateSocketedGem(packet, data.Gems[i] as SocketedGem, indexes, "Gems", i);
                        }
                    }
                }
                if (changesMask[4])
                {
                    data.Owner = packet.ReadPackedGuid128("Owner", indexes);
                }
                if (changesMask[5])
                {
                    data.ContainedIn = packet.ReadPackedGuid128("ContainedIn", indexes);
                }
                if (changesMask[6])
                {
                    data.Creator = packet.ReadPackedGuid128("Creator", indexes);
                }
                if (changesMask[7])
                {
                    data.GiftCreator = packet.ReadPackedGuid128("GiftCreator", indexes);
                }
                if (changesMask[8])
                {
                    data.StackCount = packet.ReadUInt32("StackCount", indexes);
                }
                if (changesMask[9])
                {
                    data.Expiration = packet.ReadUInt32("Expiration", indexes);
                }
                if (changesMask[10])
                {
                    data.DynamicFlags = packet.ReadUInt32("DynamicFlags", indexes);
                }
                if (changesMask[11])
                {
                    data.PropertySeed = packet.ReadInt32("PropertySeed", indexes);
                }
                if (changesMask[12])
                {
                    data.RandomPropertiesID = packet.ReadInt32("RandomPropertiesID", indexes);
                }
                if (changesMask[13])
                {
                    data.Durability = packet.ReadUInt32("Durability", indexes);
                }
                if (changesMask[14])
                {
                    data.MaxDurability = packet.ReadUInt32("MaxDurability", indexes);
                }
                if (changesMask[15])
                {
                    data.CreatePlayedTime = packet.ReadUInt32("CreatePlayedTime", indexes);
                }
                if (changesMask[16])
                {
                    data.Context = packet.ReadInt32("Context", indexes);
                }
                if (changesMask[17])
                {
                    data.CreateTime = packet.ReadInt64("CreateTime", indexes);
                }
                if (changesMask[18])
                {
                    data.ArtifactXP = packet.ReadUInt64("ArtifactXP", indexes);
                }
                if (changesMask[19])
                {
                    data.ItemAppearanceModID = packet.ReadByte("ItemAppearanceModID", indexes);
                }
                if (changesMask[21])
                {
                    data.DynamicFlags2 = packet.ReadUInt32("DynamicFlags2", indexes);
                }
                if (changesMask[20])
                {
                    data.Modifiers = ReadUpdateItemModList(packet, data.Modifiers as ItemModList, indexes, "Modifiers");
                }
            }
            if (changesMask[22])
            {
                for (var i = 0; i < 5; ++i)
                {
                    if (changesMask[23 + i])
                    {
                        data.SpellCharges[i] = packet.ReadInt32("SpellCharges", indexes, i);
                    }
                }
            }
            if (changesMask[28])
            {
                for (var i = 0; i < 13; ++i)
                {
                    if (changesMask[29 + i])
                    {
                        data.Enchantment[i] = ReadUpdateItemEnchantment(packet, data.Enchantment[i] as ItemEnchantment, indexes, "Enchantment", i);
                    }
                }
            }
            return data;
        }

        public override IContainerData ReadCreateContainerData(Packet packet, UpdateFieldFlag flags, params object[] indexes)
        {
            var data = new ContainerData();
            for (var i = 0; i < 36; ++i)
            {
                data.Slots[i] = packet.ReadPackedGuid128("Slots", indexes, i);
            }
            data.NumSlots = packet.ReadUInt32("NumSlots", indexes);
            return data;
        }

        public override IContainerData ReadUpdateContainerData(Packet packet, params object[] indexes)
        {
            var data = new ContainerData();
            var rawChangesMask = new int[2];
            var rawMaskMask = new int[1];
            rawMaskMask[0] = (int)packet.ReadBits(2);
            var maskMask = new BitArray(rawMaskMask);
            for (var i = 0; i < 2; ++i)
                if (maskMask[i])
                    rawChangesMask[i] = (int)packet.ReadBits(32);
            var changesMask = new BitArray(rawChangesMask);

            packet.ResetBitReader();
            if (changesMask[0])
            {
                if (changesMask[1])
                {
                    data.NumSlots = packet.ReadUInt32("NumSlots", indexes);
                }
            }
            if (changesMask[2])
            {
                for (var i = 0; i < 36; ++i)
                {
                    if (changesMask[3 + i])
                    {
                        data.Slots[i] = packet.ReadPackedGuid128("Slots", indexes, i);
                    }
                }
            }
            return data;
        }

        public static IUnitChannel ReadCreateUnitChannel(Packet packet, params object[] indexes)
        {
            var data = new UnitChannel();
            data.SpellID = packet.ReadInt32("SpellID", indexes);
            data.SpellXSpellVisualID = packet.ReadInt32("SpellXSpellVisualID", indexes);
            return data;
        }

        public static IUnitChannel ReadUpdateUnitChannel(Packet packet, params object[] indexes)
        {
            var data = new UnitChannel();
            data.SpellID = packet.ReadInt32("SpellID", indexes);
            data.SpellXSpellVisualID = packet.ReadInt32("SpellXSpellVisualID", indexes);
            return data;
        }

        public static IVisibleItem ReadCreateVisibleItem(Packet packet, params object[] indexes)
        {
            var data = new VisibleItem();
            data.ItemID = packet.ReadInt32("ItemID", indexes);
            data.ItemAppearanceModID = packet.ReadUInt16("ItemAppearanceModID", indexes);
            data.ItemVisual = packet.ReadUInt16("ItemVisual", indexes);
            return data;
        }

        public static IVisibleItem ReadUpdateVisibleItem(Packet packet, params object[] indexes)
        {
            var data = new VisibleItem();
            var rawChangesMask = new int[1];
            rawChangesMask[0] = (int)packet.ReadBits(4);
            var changesMask = new BitArray(rawChangesMask);

            packet.ResetBitReader();
            if (changesMask[0])
            {
                if (changesMask[1])
                {
                    data.ItemID = packet.ReadInt32("ItemID", indexes);
                }
                if (changesMask[2])
                {
                    data.ItemAppearanceModID = packet.ReadUInt16("ItemAppearanceModID", indexes);
                }
                if (changesMask[3])
                {
                    data.ItemVisual = packet.ReadUInt16("ItemVisual", indexes);
                }
            }
            return data;
        }

        public static IPassiveSpellHistory ReadCreatePassiveSpellHistory(Packet packet, params object[] indexes)
        {
            var data = new PassiveSpellHistory();
            data.SpellID = packet.ReadInt32("SpellID", indexes);
            data.AuraSpellID = packet.ReadInt32("AuraSpellID", indexes);
            return data;
        }

        public static IPassiveSpellHistory ReadUpdatePassiveSpellHistory(Packet packet, params object[] indexes)
        {
            var data = new PassiveSpellHistory();
            data.SpellID = packet.ReadInt32("SpellID", indexes);
            data.AuraSpellID = packet.ReadInt32("AuraSpellID", indexes);
            return data;
        }

        public override IUnitData ReadCreateUnitData(Packet packet, UpdateFieldFlag flags, params object[] indexes)
        {
            var data = new UnitData();
            data.Health = packet.ReadInt64("Health", indexes);
            data.MaxHealth = packet.ReadInt64("MaxHealth", indexes);
            data.DisplayID = packet.ReadInt32("DisplayID", indexes);
            for (var i = 0; i < 2; ++i)
            {
                data.NpcFlags[i] = packet.ReadUInt32("NpcFlags", indexes, i);
            }
            data.StateSpellVisualID = packet.ReadUInt32("StateSpellVisualID", indexes);
            data.StateAnimID = packet.ReadUInt32("StateAnimID", indexes);
            data.StateAnimKitID = packet.ReadUInt32("StateAnimKitID", indexes);
            data.StateWorldEffectIDs = new System.Nullable<uint>[packet.ReadUInt32()];
            for (var i = 0; i < data.StateWorldEffectIDs.Length; ++i)
            {
                data.StateWorldEffectIDs[i] = packet.ReadUInt32("StateWorldEffectIDs", indexes, i);
            }
            data.Charm = packet.ReadPackedGuid128("Charm", indexes);
            data.Summon = packet.ReadPackedGuid128("Summon", indexes);
            if ((flags & UpdateFieldFlag.Owner) != UpdateFieldFlag.None)
            {
                data.Critter = packet.ReadPackedGuid128("Critter", indexes);
            }
            data.CharmedBy = packet.ReadPackedGuid128("CharmedBy", indexes);
            data.SummonedBy = packet.ReadPackedGuid128("SummonedBy", indexes);
            data.CreatedBy = packet.ReadPackedGuid128("CreatedBy", indexes);
            data.DemonCreator = packet.ReadPackedGuid128("DemonCreator", indexes);
            data.LookAtControllerTarget = packet.ReadPackedGuid128("LookAtControllerTarget", indexes);
            data.Target = packet.ReadPackedGuid128("Target", indexes);
            data.BattlePetCompanionGUID = packet.ReadPackedGuid128("BattlePetCompanionGUID", indexes);
            data.BattlePetDBID = packet.ReadUInt64("BattlePetDBID", indexes);
            data.ChannelData = ReadCreateUnitChannel(packet, indexes, "ChannelData");
            data.SummonedByHomeRealm = packet.ReadUInt32("SummonedByHomeRealm", indexes);
            data.Race = packet.ReadByte("Race", indexes);
            data.ClassId = packet.ReadByte("ClassId", indexes);
            data.PlayerClassId = packet.ReadByte("PlayerClassId", indexes);
            data.Sex = packet.ReadByte("Sex", indexes);
            data.DisplayPower = packet.ReadByte("DisplayPower", indexes);
            data.OverrideDisplayPowerID = packet.ReadUInt32("OverrideDisplayPowerID", indexes);
            for (var i = 0; i < 7; ++i)
            {
                data.Power[i] = packet.ReadInt32("Power", indexes, i);
                data.MaxPower[i] = packet.ReadInt32("MaxPower", indexes, i);
                data.ModPowerRegen[i] = packet.ReadInt32("ModPowerRegen", indexes, i);
            }
            data.Level = packet.ReadInt32("Level", indexes);
            data.EffectiveLevel = packet.ReadInt32("EffectiveLevel", indexes);
            data.ContentTuningID = packet.ReadInt32("ContentTuningID", indexes);
            data.ScalingLevelMin = packet.ReadInt32("ScalingLevelMin", indexes);
            data.ScalingLevelMax = packet.ReadInt32("ScalingLevelMax", indexes);
            data.ScalingLevelDelta = packet.ReadInt32("ScalingLevelDelta", indexes);
            data.ScalingFactionGroup = packet.ReadInt32("ScalingFactionGroup", indexes);
            data.ScalingHealthItemLevelCurveID = packet.ReadInt32("ScalingHealthItemLevelCurveID", indexes);
            data.ScalingDamageItemLevelCurveID = packet.ReadInt32("ScalingDamageItemLevelCurveID", indexes);
            data.FactionTemplate = packet.ReadInt32("FactionTemplate", indexes);
            for (var i = 0; i < 3; ++i)
            {
                data.VirtualItems[i] = ReadCreateVisibleItem(packet, indexes, "VirtualItems", i);
            }
            data.Flags = packet.ReadUInt32("Flags", indexes);
            data.Flags2 = packet.ReadUInt32("Flags2", indexes);
            data.Flags3 = packet.ReadUInt32("Flags3", indexes);
            data.AuraState = packet.ReadUInt32("AuraState", indexes);
            for (var i = 0; i < 2; ++i)
            {
                data.AttackRoundBaseTime[i] = packet.ReadUInt32("AttackRoundBaseTime", indexes, i);
            }
            if ((flags & UpdateFieldFlag.Owner) != UpdateFieldFlag.None)
            {
                data.RangedAttackRoundBaseTime = packet.ReadUInt32("RangedAttackRoundBaseTime", indexes);
            }
            data.BoundingRadius = packet.ReadSingle("BoundingRadius", indexes);
            data.CombatReach = packet.ReadSingle("CombatReach", indexes);
            data.DisplayScale = packet.ReadSingle("DisplayScale", indexes);
            data.NativeDisplayID = packet.ReadInt32("NativeDisplayID", indexes);
            data.NativeXDisplayScale = packet.ReadSingle("NativeXDisplayScale", indexes);
            data.MountDisplayID = packet.ReadInt32("MountDisplayID", indexes);
            if ((flags & (UpdateFieldFlag.Owner | UpdateFieldFlag.Empath)) != UpdateFieldFlag.None)
            {
                data.MinDamage = packet.ReadSingle("MinDamage", indexes);
                data.MaxDamage = packet.ReadSingle("MaxDamage", indexes);
                data.MinOffHandDamage = packet.ReadSingle("MinOffHandDamage", indexes);
                data.MaxOffHandDamage = packet.ReadSingle("MaxOffHandDamage", indexes);
            }
            data.StandState = packet.ReadByte("StandState", indexes);
            data.PetTalentPoints = packet.ReadByte("PetTalentPoints", indexes);
            data.VisFlags = packet.ReadByte("VisFlags", indexes);
            data.AnimTier = packet.ReadByte("AnimTier", indexes);
            data.PetNumber = packet.ReadUInt32("PetNumber", indexes);
            data.PetNameTimestamp = packet.ReadUInt32("PetNameTimestamp", indexes);
            data.PetExperience = packet.ReadUInt32("PetExperience", indexes);
            data.PetNextLevelExperience = packet.ReadUInt32("PetNextLevelExperience", indexes);
            data.ModCastingSpeed = packet.ReadSingle("ModCastingSpeed", indexes);
            data.ModSpellHaste = packet.ReadSingle("ModSpellHaste", indexes);
            data.ModHaste = packet.ReadSingle("ModHaste", indexes);
            data.ModRangedHaste = packet.ReadSingle("ModRangedHaste", indexes);
            data.ModHasteRegen = packet.ReadSingle("ModHasteRegen", indexes);
            data.ModTimeRate = packet.ReadSingle("ModTimeRate", indexes);
            data.CreatedBySpell = packet.ReadInt32("CreatedBySpell", indexes);
            data.EmoteState = packet.ReadInt32("EmoteState", indexes);
            data.TrainingPointsUsed = packet.ReadUInt16("TrainingPointsUsed", indexes);
            data.TrainingPointsTotal = packet.ReadUInt16("TrainingPointsTotal", indexes);
            if ((flags & UpdateFieldFlag.Owner) != UpdateFieldFlag.None)
            {
                for (var i = 0; i < 5; ++i)
                {
                    data.Stats[i] = packet.ReadInt32("Stats", indexes, i);
                    data.StatPosBuff[i] = packet.ReadInt32("StatPosBuff", indexes, i);
                    data.StatNegBuff[i] = packet.ReadInt32("StatNegBuff", indexes, i);
                }
            }
            if ((flags & (UpdateFieldFlag.Owner | UpdateFieldFlag.Empath)) != UpdateFieldFlag.None)
            {
                for (var i = 0; i < 7; ++i)
                {
                    data.Resistances[i] = packet.ReadInt32("Resistances", indexes, i);
                }
            }
            if ((flags & UpdateFieldFlag.Owner) != UpdateFieldFlag.None)
            {
                for (var i = 0; i < 7; ++i)
                {
                    data.PowerCostModifier[i] = packet.ReadInt32("PowerCostModifier", indexes, i);
                    data.PowerCostMultiplier[i] = packet.ReadSingle("PowerCostMultiplier", indexes, i);
                }
            }
            for (var i = 0; i < 7; ++i)
            {
                data.ResistanceBuffModsPositive[i] = packet.ReadInt32("ResistanceBuffModsPositive", indexes, i);
                data.ResistanceBuffModsNegative[i] = packet.ReadInt32("ResistanceBuffModsNegative", indexes, i);
            }
            data.BaseMana = packet.ReadInt32("BaseMana", indexes);
            if ((flags & UpdateFieldFlag.Owner) != UpdateFieldFlag.None)
            {
                data.BaseHealth = packet.ReadInt32("BaseHealth", indexes);
            }
            data.SheatheState = packet.ReadByte("SheatheState", indexes);
            data.PvpFlags = packet.ReadByte("PvpFlags", indexes);
            data.PetFlags = packet.ReadByte("PetFlags", indexes);
            data.ShapeshiftForm = packet.ReadByte("ShapeshiftForm", indexes);
            if ((flags & UpdateFieldFlag.Owner) != UpdateFieldFlag.None)
            {
                data.AttackPower = packet.ReadInt32("AttackPower", indexes);
                data.AttackPowerModPos = packet.ReadInt32("AttackPowerModPos", indexes);
                data.AttackPowerModNeg = packet.ReadInt32("AttackPowerModNeg", indexes);
                data.AttackPowerMultiplier = packet.ReadSingle("AttackPowerMultiplier", indexes);
                data.RangedAttackPower = packet.ReadInt32("RangedAttackPower", indexes);
                data.RangedAttackPowerModPos = packet.ReadInt32("RangedAttackPowerModPos", indexes);
                data.RangedAttackPowerModNeg = packet.ReadInt32("RangedAttackPowerModNeg", indexes);
                data.RangedAttackPowerMultiplier = packet.ReadSingle("RangedAttackPowerMultiplier", indexes);
                data.SetAttackSpeedAura = packet.ReadInt32("SetAttackSpeedAura", indexes);
                data.Lifesteal = packet.ReadSingle("Lifesteal", indexes);
                data.MinRangedDamage = packet.ReadSingle("MinRangedDamage", indexes);
                data.MaxRangedDamage = packet.ReadSingle("MaxRangedDamage", indexes);
                data.MaxHealthModifier = packet.ReadSingle("MaxHealthModifier", indexes);
            }
            data.HoverHeight = packet.ReadSingle("HoverHeight", indexes);
            data.MinItemLevelCutoff = packet.ReadInt32("MinItemLevelCutoff", indexes);
            data.MinItemLevel = packet.ReadInt32("MinItemLevel", indexes);
            data.MaxItemLevel = packet.ReadInt32("MaxItemLevel", indexes);
            data.WildBattlePetLevel = packet.ReadInt32("WildBattlePetLevel", indexes);
            data.BattlePetCompanionNameTimestamp = packet.ReadUInt32("BattlePetCompanionNameTimestamp", indexes);
            data.InteractSpellID = packet.ReadInt32("InteractSpellID", indexes);
            data.ScaleDuration = packet.ReadInt32("ScaleDuration", indexes);
            data.LooksLikeMountID = packet.ReadInt32("LooksLikeMountID", indexes);
            data.LooksLikeCreatureID = packet.ReadInt32("LooksLikeCreatureID", indexes);
            data.LookAtControllerID = packet.ReadInt32("LookAtControllerID", indexes);
            data.GuildGUID = packet.ReadPackedGuid128("GuildGUID", indexes);
            data.PassiveSpells.Resize(packet.ReadUInt32());
            data.WorldEffects.Resize(packet.ReadUInt32());
            data.ChannelObjects.Resize(packet.ReadUInt32());
            data.SkinningOwnerGUID = packet.ReadPackedGuid128("SkinningOwnerGUID", indexes);
            for (var i = 0; i < data.PassiveSpells.Count; ++i)
            {
                data.PassiveSpells[i] = ReadCreatePassiveSpellHistory(packet, indexes, "PassiveSpells", i);
            }
            for (var i = 0; i < data.WorldEffects.Count; ++i)
            {
                data.WorldEffects[i] = packet.ReadInt32("WorldEffects", indexes, i);
            }
            for (var i = 0; i < data.ChannelObjects.Count; ++i)
            {
                data.ChannelObjects[i] = packet.ReadPackedGuid128("ChannelObjects", indexes, i);
            }
            return data;
        }

        public override IUnitData ReadUpdateUnitData(Packet packet, params object[] indexes)
        {
            var data = new UnitData();
            var rawChangesMask = new int[7];
            var rawMaskMask = new int[1];
            rawMaskMask[0] = (int)packet.ReadBits(7);
            var maskMask = new BitArray(rawMaskMask);
            for (var i = 0; i < 7; ++i)
                if (maskMask[i])
                    rawChangesMask[i] = (int)packet.ReadBits(32);
            var changesMask = new BitArray(rawChangesMask);

            if (changesMask[0])
            {
                if (changesMask[1])
                {
                    data.StateWorldEffectIDs = Enumerable.Range(0, (int)packet.ReadBits(32)).Select(x => new uint()).Cast<System.Nullable<uint>>().ToArray();
                    for (var i = 0; i < data.StateWorldEffectIDs.Length; ++i)
                    {
                        data.StateWorldEffectIDs[i] = packet.ReadUInt32("StateWorldEffectIDs", indexes, i);
                    }
                }
            }
            packet.ResetBitReader();
            if (changesMask[0])
            {
                if (changesMask[2])
                {
                    data.PassiveSpells.ReadUpdateMask(packet);
                }
                if (changesMask[3])
                {
                    data.WorldEffects.ReadUpdateMask(packet);
                }
                if (changesMask[4])
                {
                    data.ChannelObjects.ReadUpdateMask(packet);
                }
            }
            packet.ResetBitReader();
            if (changesMask[0])
            {
                if (changesMask[2])
                {
                    for (var i = 0; i < data.PassiveSpells.Count; ++i)
                    {
                        if (data.PassiveSpells.UpdateMask[i])
                        {
                            data.PassiveSpells[i] = ReadUpdatePassiveSpellHistory(packet, data.PassiveSpells[i] as PassiveSpellHistory, indexes, "PassiveSpells", i);
                        }
                    }
                }
                if (changesMask[3])
                {
                    for (var i = 0; i < data.WorldEffects.Count; ++i)
                    {
                        if (data.WorldEffects.UpdateMask[i])
                        {
                            data.WorldEffects[i] = packet.ReadInt32("WorldEffects", indexes, i);
                        }
                    }
                }
                if (changesMask[4])
                {
                    for (var i = 0; i < data.ChannelObjects.Count; ++i)
                    {
                        if (data.ChannelObjects.UpdateMask[i])
                        {
                            data.ChannelObjects[i] = packet.ReadPackedGuid128("ChannelObjects", indexes, i);
                        }
                    }
                }
                if (changesMask[5])
                {
                    data.Health = packet.ReadInt64("Health", indexes);
                }
                if (changesMask[6])
                {
                    data.MaxHealth = packet.ReadInt64("MaxHealth", indexes);
                }
                if (changesMask[7])
                {
                    data.DisplayID = packet.ReadInt32("DisplayID", indexes);
                }
                if (changesMask[8])
                {
                    data.StateSpellVisualID = packet.ReadUInt32("StateSpellVisualID", indexes);
                }
                if (changesMask[9])
                {
                    data.StateAnimID = packet.ReadUInt32("StateAnimID", indexes);
                }
                if (changesMask[10])
                {
                    data.StateAnimKitID = packet.ReadUInt32("StateAnimKitID", indexes);
                }
                if (changesMask[11])
                {
                    data.Charm = packet.ReadPackedGuid128("Charm", indexes);
                }
                if (changesMask[12])
                {
                    data.Summon = packet.ReadPackedGuid128("Summon", indexes);
                }
                if (changesMask[13])
                {
                    data.Critter = packet.ReadPackedGuid128("Critter", indexes);
                }
                if (changesMask[14])
                {
                    data.CharmedBy = packet.ReadPackedGuid128("CharmedBy", indexes);
                }
                if (changesMask[15])
                {
                    data.SummonedBy = packet.ReadPackedGuid128("SummonedBy", indexes);
                }
                if (changesMask[16])
                {
                    data.CreatedBy = packet.ReadPackedGuid128("CreatedBy", indexes);
                }
                if (changesMask[17])
                {
                    data.DemonCreator = packet.ReadPackedGuid128("DemonCreator", indexes);
                }
                if (changesMask[18])
                {
                    data.LookAtControllerTarget = packet.ReadPackedGuid128("LookAtControllerTarget", indexes);
                }
                if (changesMask[19])
                {
                    data.Target = packet.ReadPackedGuid128("Target", indexes);
                }
                if (changesMask[20])
                {
                    data.BattlePetCompanionGUID = packet.ReadPackedGuid128("BattlePetCompanionGUID", indexes);
                }
                if (changesMask[21])
                {
                    data.BattlePetDBID = packet.ReadUInt64("BattlePetDBID", indexes);
                }
                if (changesMask[22])
                {
                    data.ChannelData = ReadUpdateUnitChannel(packet, data.ChannelData as UnitChannel, indexes, "ChannelData");
                }
                if (changesMask[23])
                {
                    data.SummonedByHomeRealm = packet.ReadUInt32("SummonedByHomeRealm", indexes);
                }
                if (changesMask[24])
                {
                    data.Race = packet.ReadByte("Race", indexes);
                }
                if (changesMask[25])
                {
                    data.ClassId = packet.ReadByte("ClassId", indexes);
                }
                if (changesMask[26])
                {
                    data.PlayerClassId = packet.ReadByte("PlayerClassId", indexes);
                }
                if (changesMask[27])
                {
                    data.Sex = packet.ReadByte("Sex", indexes);
                }
                if (changesMask[28])
                {
                    data.DisplayPower = packet.ReadByte("DisplayPower", indexes);
                }
                if (changesMask[29])
                {
                    data.OverrideDisplayPowerID = packet.ReadUInt32("OverrideDisplayPowerID", indexes);
                }
                if (changesMask[30])
                {
                    data.Level = packet.ReadInt32("Level", indexes);
                }
                if (changesMask[31])
                {
                    data.EffectiveLevel = packet.ReadInt32("EffectiveLevel", indexes);
                }
            }
            if (changesMask[32])
            {
                if (changesMask[33])
                {
                    data.ContentTuningID = packet.ReadInt32("ContentTuningID", indexes);
                }
                if (changesMask[34])
                {
                    data.ScalingLevelMin = packet.ReadInt32("ScalingLevelMin", indexes);
                }
                if (changesMask[35])
                {
                    data.ScalingLevelMax = packet.ReadInt32("ScalingLevelMax", indexes);
                }
                if (changesMask[36])
                {
                    data.ScalingLevelDelta = packet.ReadInt32("ScalingLevelDelta", indexes);
                }
                if (changesMask[37])
                {
                    data.ScalingFactionGroup = packet.ReadInt32("ScalingFactionGroup", indexes);
                }
                if (changesMask[38])
                {
                    data.ScalingHealthItemLevelCurveID = packet.ReadInt32("ScalingHealthItemLevelCurveID", indexes);
                }
                if (changesMask[39])
                {
                    data.ScalingDamageItemLevelCurveID = packet.ReadInt32("ScalingDamageItemLevelCurveID", indexes);
                }
                if (changesMask[40])
                {
                    data.FactionTemplate = packet.ReadInt32("FactionTemplate", indexes);
                }
                if (changesMask[41])
                {
                    data.Flags = packet.ReadUInt32("Flags", indexes);
                }
                if (changesMask[42])
                {
                    data.Flags2 = packet.ReadUInt32("Flags2", indexes);
                }
                if (changesMask[43])
                {
                    data.Flags3 = packet.ReadUInt32("Flags3", indexes);
                }
                if (changesMask[44])
                {
                    data.AuraState = packet.ReadUInt32("AuraState", indexes);
                }
                if (changesMask[45])
                {
                    data.RangedAttackRoundBaseTime = packet.ReadUInt32("RangedAttackRoundBaseTime", indexes);
                }
                if (changesMask[46])
                {
                    data.BoundingRadius = packet.ReadSingle("BoundingRadius", indexes);
                }
                if (changesMask[47])
                {
                    data.CombatReach = packet.ReadSingle("CombatReach", indexes);
                }
                if (changesMask[48])
                {
                    data.DisplayScale = packet.ReadSingle("DisplayScale", indexes);
                }
                if (changesMask[49])
                {
                    data.NativeDisplayID = packet.ReadInt32("NativeDisplayID", indexes);
                }
                if (changesMask[50])
                {
                    data.NativeXDisplayScale = packet.ReadSingle("NativeXDisplayScale", indexes);
                }
                if (changesMask[51])
                {
                    data.MountDisplayID = packet.ReadInt32("MountDisplayID", indexes);
                }
                if (changesMask[52])
                {
                    data.MinDamage = packet.ReadSingle("MinDamage", indexes);
                }
                if (changesMask[53])
                {
                    data.MaxDamage = packet.ReadSingle("MaxDamage", indexes);
                }
                if (changesMask[54])
                {
                    data.MinOffHandDamage = packet.ReadSingle("MinOffHandDamage", indexes);
                }
                if (changesMask[55])
                {
                    data.MaxOffHandDamage = packet.ReadSingle("MaxOffHandDamage", indexes);
                }
                if (changesMask[56])
                {
                    data.StandState = packet.ReadByte("StandState", indexes);
                }
                if (changesMask[57])
                {
                    data.PetTalentPoints = packet.ReadByte("PetTalentPoints", indexes);
                }
                if (changesMask[58])
                {
                    data.VisFlags = packet.ReadByte("VisFlags", indexes);
                }
                if (changesMask[59])
                {
                    data.AnimTier = packet.ReadByte("AnimTier", indexes);
                }
                if (changesMask[60])
                {
                    data.PetNumber = packet.ReadUInt32("PetNumber", indexes);
                }
                if (changesMask[61])
                {
                    data.PetNameTimestamp = packet.ReadUInt32("PetNameTimestamp", indexes);
                }
                if (changesMask[62])
                {
                    data.PetExperience = packet.ReadUInt32("PetExperience", indexes);
                }
                if (changesMask[63])
                {
                    data.PetNextLevelExperience = packet.ReadUInt32("PetNextLevelExperience", indexes);
                }
            }
            if (changesMask[64])
            {
                if (changesMask[65])
                {
                    data.ModCastingSpeed = packet.ReadSingle("ModCastingSpeed", indexes);
                }
                if (changesMask[66])
                {
                    data.ModSpellHaste = packet.ReadSingle("ModSpellHaste", indexes);
                }
                if (changesMask[67])
                {
                    data.ModHaste = packet.ReadSingle("ModHaste", indexes);
                }
                if (changesMask[68])
                {
                    data.ModRangedHaste = packet.ReadSingle("ModRangedHaste", indexes);
                }
                if (changesMask[69])
                {
                    data.ModHasteRegen = packet.ReadSingle("ModHasteRegen", indexes);
                }
                if (changesMask[70])
                {
                    data.ModTimeRate = packet.ReadSingle("ModTimeRate", indexes);
                }
                if (changesMask[71])
                {
                    data.CreatedBySpell = packet.ReadInt32("CreatedBySpell", indexes);
                }
                if (changesMask[72])
                {
                    data.EmoteState = packet.ReadInt32("EmoteState", indexes);
                }
                if (changesMask[73])
                {
                    data.TrainingPointsUsed = packet.ReadUInt16("TrainingPointsUsed", indexes);
                }
                if (changesMask[74])
                {
                    data.TrainingPointsTotal = packet.ReadUInt16("TrainingPointsTotal", indexes);
                }
                if (changesMask[75])
                {
                    data.BaseMana = packet.ReadInt32("BaseMana", indexes);
                }
                if (changesMask[76])
                {
                    data.BaseHealth = packet.ReadInt32("BaseHealth", indexes);
                }
                if (changesMask[77])
                {
                    data.SheatheState = packet.ReadByte("SheatheState", indexes);
                }
                if (changesMask[78])
                {
                    data.PvpFlags = packet.ReadByte("PvpFlags", indexes);
                }
                if (changesMask[79])
                {
                    data.PetFlags = packet.ReadByte("PetFlags", indexes);
                }
                if (changesMask[80])
                {
                    data.ShapeshiftForm = packet.ReadByte("ShapeshiftForm", indexes);
                }
                if (changesMask[81])
                {
                    data.AttackPower = packet.ReadInt32("AttackPower", indexes);
                }
                if (changesMask[82])
                {
                    data.AttackPowerModPos = packet.ReadInt32("AttackPowerModPos", indexes);
                }
                if (changesMask[83])
                {
                    data.AttackPowerModNeg = packet.ReadInt32("AttackPowerModNeg", indexes);
                }
                if (changesMask[84])
                {
                    data.AttackPowerMultiplier = packet.ReadSingle("AttackPowerMultiplier", indexes);
                }
                if (changesMask[85])
                {
                    data.RangedAttackPower = packet.ReadInt32("RangedAttackPower", indexes);
                }
                if (changesMask[86])
                {
                    data.RangedAttackPowerModPos = packet.ReadInt32("RangedAttackPowerModPos", indexes);
                }
                if (changesMask[87])
                {
                    data.RangedAttackPowerModNeg = packet.ReadInt32("RangedAttackPowerModNeg", indexes);
                }
                if (changesMask[88])
                {
                    data.RangedAttackPowerMultiplier = packet.ReadSingle("RangedAttackPowerMultiplier", indexes);
                }
                if (changesMask[89])
                {
                    data.SetAttackSpeedAura = packet.ReadInt32("SetAttackSpeedAura", indexes);
                }
                if (changesMask[90])
                {
                    data.Lifesteal = packet.ReadSingle("Lifesteal", indexes);
                }
                if (changesMask[91])
                {
                    data.MinRangedDamage = packet.ReadSingle("MinRangedDamage", indexes);
                }
                if (changesMask[92])
                {
                    data.MaxRangedDamage = packet.ReadSingle("MaxRangedDamage", indexes);
                }
                if (changesMask[93])
                {
                    data.MaxHealthModifier = packet.ReadSingle("MaxHealthModifier", indexes);
                }
                if (changesMask[94])
                {
                    data.HoverHeight = packet.ReadSingle("HoverHeight", indexes);
                }
                if (changesMask[95])
                {
                    data.MinItemLevelCutoff = packet.ReadInt32("MinItemLevelCutoff", indexes);
                }
            }
            if (changesMask[96])
            {
                if (changesMask[97])
                {
                    data.MinItemLevel = packet.ReadInt32("MinItemLevel", indexes);
                }
                if (changesMask[98])
                {
                    data.MaxItemLevel = packet.ReadInt32("MaxItemLevel", indexes);
                }
                if (changesMask[99])
                {
                    data.WildBattlePetLevel = packet.ReadInt32("WildBattlePetLevel", indexes);
                }
                if (changesMask[100])
                {
                    data.BattlePetCompanionNameTimestamp = packet.ReadUInt32("BattlePetCompanionNameTimestamp", indexes);
                }
                if (changesMask[101])
                {
                    data.InteractSpellID = packet.ReadInt32("InteractSpellID", indexes);
                }
                if (changesMask[102])
                {
                    data.ScaleDuration = packet.ReadInt32("ScaleDuration", indexes);
                }
                if (changesMask[103])
                {
                    data.LooksLikeMountID = packet.ReadInt32("LooksLikeMountID", indexes);
                }
                if (changesMask[104])
                {
                    data.LooksLikeCreatureID = packet.ReadInt32("LooksLikeCreatureID", indexes);
                }
                if (changesMask[105])
                {
                    data.LookAtControllerID = packet.ReadInt32("LookAtControllerID", indexes);
                }
                if (changesMask[106])
                {
                    data.GuildGUID = packet.ReadPackedGuid128("GuildGUID", indexes);
                }
                if (changesMask[107])
                {
                    data.SkinningOwnerGUID = packet.ReadPackedGuid128("SkinningOwnerGUID", indexes);
                }
            }
            if (changesMask[108])
            {
                for (var i = 0; i < 2; ++i)
                {
                    if (changesMask[109 + i])
                    {
                        data.NpcFlags[i] = packet.ReadUInt32("NpcFlags", indexes, i);
                    }
                }
            }
            if (changesMask[111])
            {
                for (var i = 0; i < 7; ++i)
                {
                    if (changesMask[112 + i])
                    {
                        data.Power[i] = packet.ReadInt32("Power", indexes, i);
                    }
                    if (changesMask[119 + i])
                    {
                        data.MaxPower[i] = packet.ReadInt32("MaxPower", indexes, i);
                    }
                    if (changesMask[126 + i])
                    {
                        data.ModPowerRegen[i] = packet.ReadInt32("ModPowerRegen", indexes, i);
                    }
                }
            }
            if (changesMask[133])
            {
                for (var i = 0; i < 3; ++i)
                {
                    if (changesMask[134 + i])
                    {
                        data.VirtualItems[i] = ReadUpdateVisibleItem(packet, data.VirtualItems[i] as VisibleItem, indexes, "VirtualItems", i);
                    }
                }
            }
            if (changesMask[137])
            {
                for (var i = 0; i < 2; ++i)
                {
                    if (changesMask[138 + i])
                    {
                        data.AttackRoundBaseTime[i] = packet.ReadUInt32("AttackRoundBaseTime", indexes, i);
                    }
                }
            }
            if (changesMask[140])
            {
                for (var i = 0; i < 5; ++i)
                {
                    if (changesMask[141 + i])
                    {
                        data.Stats[i] = packet.ReadInt32("Stats", indexes, i);
                    }
                    if (changesMask[146 + i])
                    {
                        data.StatPosBuff[i] = packet.ReadInt32("StatPosBuff", indexes, i);
                    }
                    if (changesMask[151 + i])
                    {
                        data.StatNegBuff[i] = packet.ReadInt32("StatNegBuff", indexes, i);
                    }
                }
            }
            if (changesMask[156])
            {
                for (var i = 0; i < 7; ++i)
                {
                    if (changesMask[157 + i])
                    {
                        data.Resistances[i] = packet.ReadInt32("Resistances", indexes, i);
                    }
                    if (changesMask[164 + i])
                    {
                        data.PowerCostModifier[i] = packet.ReadInt32("PowerCostModifier", indexes, i);
                    }
                    if (changesMask[171 + i])
                    {
                        data.PowerCostMultiplier[i] = packet.ReadSingle("PowerCostMultiplier", indexes, i);
                    }
                }
            }
            if (changesMask[178])
            {
                for (int i = 0; i < 7; ++i)
                {
                    if (changesMask[179 + i])
                    {
                        data.ResistanceBuffModsPositive[i] = packet.ReadInt32("ResistanceBuffModsPositive", indexes, i);
                    }
                    if (changesMask[186 + i])
                    {
                        data.ResistanceBuffModsNegative[i] = packet.ReadInt32("ResistanceBuffModsNegative", indexes, i);
                    }
                }
            }
            return data;
        }

        public static IChrCustomizationChoice ReadCreateChrCustomizationChoice(Packet packet, params object[] indexes)
        {
            var data = new ChrCustomizationChoice();
            data.ChrCustomizationOptionID = packet.ReadUInt32("ChrCustomizationOptionID", indexes);
            data.ChrCustomizationChoiceID = packet.ReadUInt32("ChrCustomizationChoiceID", indexes);
            return data;
        }

        public static IChrCustomizationChoice ReadUpdateChrCustomizationChoice(Packet packet, params object[] indexes)
        {
            var data = new ChrCustomizationChoice();
            data.ChrCustomizationOptionID = packet.ReadUInt32("ChrCustomizationOptionID", indexes);
            data.ChrCustomizationChoiceID = packet.ReadUInt32("ChrCustomizationChoiceID", indexes);
            return data;
        }

        public static IQuestLog ReadCreateQuestLog(Packet packet, params object[] indexes)
        {
            var data = new QuestLog();
            data.QuestID = packet.ReadInt32("QuestID", indexes);
            data.StateFlags = packet.ReadUInt32("StateFlags", indexes);
            data.EndTime = packet.ReadUInt32("EndTime", indexes);
            data.AcceptTime = packet.ReadUInt32("AcceptTime", indexes);
            for (var i = 0; i < 24; ++i)
            {
                data.ObjectiveProgress[i] = packet.ReadInt16("ObjectiveProgress", indexes, i);
            }
            return data;
        }

        public static IQuestLog ReadUpdateQuestLog(Packet packet, params object[] indexes)
        {
            var data = new QuestLog();
            var rawChangesMask = new int[1];
            var rawMaskMask = new int[1];
            rawMaskMask[0] = (int)packet.ReadBits(1);
            var maskMask = new BitArray(rawMaskMask);
            if (maskMask[0])
                rawChangesMask[0] = (int)packet.ReadBits(32);
            var changesMask = new BitArray(rawChangesMask);

            packet.ResetBitReader();
            if (changesMask[0])
            {
                if (changesMask[1])
                {
                    data.QuestID = packet.ReadInt32("QuestID", indexes);
                }
                if (changesMask[2])
                {
                    data.StateFlags = packet.ReadUInt32("StateFlags", indexes);
                }
                if (changesMask[3])
                {
                    data.EndTime = packet.ReadUInt32("EndTime", indexes);
                }
                if (changesMask[4])
                {
                    data.AcceptTime = packet.ReadUInt32("AcceptTime", indexes);
                }
            }
            if (changesMask[5])
            {
                for (var i = 0; i < 24; ++i)
                {
                    if (changesMask[6 + i])
                    {
                        data.ObjectiveProgress[i] = packet.ReadInt16("ObjectiveProgress", indexes, i);
                    }
                }
            }
            return data;
        }

        public static IArenaCooldown ReadCreateArenaCooldown(Packet packet, params object[] indexes)
        {
            var data = new ArenaCooldown();
            data.SpellID = packet.ReadInt32("SpellID", indexes);
            data.Charges = packet.ReadInt32("Charges", indexes);
            data.Unk254 = packet.ReadInt32("Unk254", indexes);
            data.Flags = packet.ReadUInt32("Flags", indexes);
            data.StartTime = packet.ReadUInt32("StartTime", indexes);
            data.EndTime = packet.ReadUInt32("EndTime", indexes);
            data.NextChargeTime = packet.ReadUInt32("NextChargeTime", indexes);
            data.MaxCharges = packet.ReadByte("MaxCharges", indexes);
            return data;
        }

        public static IArenaCooldown ReadUpdateArenaCooldown(Packet packet, params object[] indexes)
        {
            var data = new ArenaCooldown();
            var rawChangesMask = new int[1];
            rawChangesMask[0] = (int)packet.ReadBits(9);
            var changesMask = new BitArray(rawChangesMask);

            packet.ResetBitReader();
            if (changesMask[0])
            {
                if (changesMask[1])
                {
                    data.SpellID = packet.ReadInt32("SpellID", indexes);
                }
                if (changesMask[2])
                {
                    data.Charges = packet.ReadInt32("Charges", indexes);
                }
                if (changesMask[3])
                {
                    data.Unk254 = packet.ReadInt32("Unk254", indexes);
                }
                if (changesMask[4])
                {
                    data.Flags = packet.ReadUInt32("Flags", indexes);
                }
                if (changesMask[5])
                {
                    data.StartTime = packet.ReadUInt32("StartTime", indexes);
                }
                if (changesMask[6])
                {
                    data.EndTime = packet.ReadUInt32("EndTime", indexes);
                }
                if (changesMask[7])
                {
                    data.NextChargeTime = packet.ReadUInt32("NextChargeTime", indexes);
                }
                if (changesMask[8])
                {
                    data.MaxCharges = packet.ReadByte("MaxCharges", indexes);
                }
            }
            return data;
        }

        public override IPlayerData ReadCreatePlayerData(Packet packet, UpdateFieldFlag flags, params object[] indexes)
        {
            var data = new PlayerData();
            data.DuelArbiter = packet.ReadPackedGuid128("DuelArbiter", indexes);
            data.WowAccount = packet.ReadPackedGuid128("WowAccount", indexes);
            data.LootTargetGUID = packet.ReadPackedGuid128("LootTargetGUID", indexes);
            data.PlayerFlags = packet.ReadUInt32("PlayerFlags", indexes);
            data.PlayerFlagsEx = packet.ReadUInt32("PlayerFlagsEx", indexes);
            data.GuildRankID = packet.ReadUInt32("GuildRankID", indexes);
            data.GuildDeleteDate = packet.ReadUInt32("GuildDeleteDate", indexes);
            data.GuildLevel = packet.ReadInt32("GuildLevel", indexes);
            data.Customizations.Resize(packet.ReadUInt32());
            data.PartyType = packet.ReadByte("PartyType", indexes);
            data.NativeSex = packet.ReadByte("NativeSex", indexes);
            data.Inebriation = packet.ReadByte("Inebriation", indexes);
            data.PvpTitle = packet.ReadByte("PvpTitle", indexes);
            data.ArenaFaction = packet.ReadByte("ArenaFaction", indexes);
            data.PvpRank = packet.ReadByte("PvpRank", indexes);
            data.Unk254 = packet.ReadByte("Unk254", indexes);
            data.DuelTeam = packet.ReadUInt32("DuelTeam", indexes);
            data.GuildTimeStamp = packet.ReadInt32("GuildTimeStamp", indexes);
            if ((flags & UpdateFieldFlag.PartyMember) != UpdateFieldFlag.None)
            {
                for (var i = 0; i < 25; ++i)
                {
                    data.QuestLog[i] = ReadCreateQuestLog(packet, indexes, "QuestLog", i);
                }
            }
            for (var i = 0; i < 19; ++i)
            {
                data.VisibleItems[i] = ReadCreateVisibleItem(packet, indexes, "VisibleItems", i);
            }
            data.PlayerTitle = packet.ReadInt32("PlayerTitle", indexes);
            data.FakeInebriation = packet.ReadInt32("FakeInebriation", indexes);
            data.VirtualPlayerRealm = packet.ReadUInt32("VirtualPlayerRealm", indexes);
            data.CurrentSpecID = packet.ReadUInt32("CurrentSpecID", indexes);
            data.TaxiMountAnimKitID = packet.ReadInt32("TaxiMountAnimKitID", indexes);
            for (var i = 0; i < 6; ++i)
            {
                data.AvgItemLevel[i] = packet.ReadSingle("AvgItemLevel", indexes, i);
            }
            data.CurrentBattlePetBreedQuality = packet.ReadByte("CurrentBattlePetBreedQuality", indexes);
            data.HonorLevel = packet.ReadInt32("HonorLevel", indexes);
            data.ArenaCooldowns.Resize(packet.ReadUInt32());
            for (var i = 0; i < data.Customizations.Count; ++i)
            {
                data.Customizations[i] = ReadCreateChrCustomizationChoice(packet, indexes, "Customizations", i);
            }
            for (var i = 0; i < data.ArenaCooldowns.Count; ++i)
            {
                data.ArenaCooldowns[i] = ReadCreateArenaCooldown(packet, indexes, "ArenaCooldowns", i);
            }
            return data;
        }

        public override IPlayerData ReadUpdatePlayerData(Packet packet, params object[] indexes)
        {
            var data = new PlayerData();
            var rawChangesMask = new int[3];
            var rawMaskMask = new int[1];
            rawMaskMask[0] = (int)packet.ReadBits(3);
            var maskMask = new BitArray(rawMaskMask);
            for (var i = 0; i < 3; ++i)
                if (maskMask[i])
                    rawChangesMask[i] = (int)packet.ReadBits(32);
            var changesMask = new BitArray(rawChangesMask);

            var noQuestLogChangesMask = packet.ReadBit();
            if (changesMask[0])
            {
                if (changesMask[1])
                {
                    data.Customizations.ReadUpdateMask(packet);
                }
                if (changesMask[2])
                {
                    data.ArenaCooldowns.ReadUpdateMask(packet);
                }
            }
            packet.ResetBitReader();
            if (changesMask[0])
            {
                if (changesMask[1])
                {
                    for (var i = 0; i < data.Customizations.Count; ++i)
                    {
                        if (data.Customizations.UpdateMask[i])
                        {
                            data.Customizations[i] = ReadUpdateChrCustomizationChoice(packet, data.Customizations[i] as ChrCustomizationChoice, indexes, "Customizations", i);
                        }
                    }
                }
                if (changesMask[2])
                {
                    for (var i = 0; i < data.ArenaCooldowns.Count; ++i)
                    {
                        if (data.ArenaCooldowns.UpdateMask[i])
                        {
                            data.ArenaCooldowns[i] = ReadUpdateArenaCooldown(packet, data.ArenaCooldowns[i] as ArenaCooldown, indexes, "ArenaCooldowns", i);
                        }
                    }
                }
                if (changesMask[3])
                {
                    data.DuelArbiter = packet.ReadPackedGuid128("DuelArbiter", indexes);
                }
                if (changesMask[4])
                {
                    data.WowAccount = packet.ReadPackedGuid128("WowAccount", indexes);
                }
                if (changesMask[5])
                {
                    data.LootTargetGUID = packet.ReadPackedGuid128("LootTargetGUID", indexes);
                }
                if (changesMask[6])
                {
                    data.PlayerFlags = packet.ReadUInt32("PlayerFlags", indexes);
                }
                if (changesMask[7])
                {
                    data.PlayerFlagsEx = packet.ReadUInt32("PlayerFlagsEx", indexes);
                }
                if (changesMask[8])
                {
                    data.GuildRankID = packet.ReadUInt32("GuildRankID", indexes);
                }
                if (changesMask[9])
                {
                    data.GuildDeleteDate = packet.ReadUInt32("GuildDeleteDate", indexes);
                }
                if (changesMask[10])
                {
                    data.GuildLevel = packet.ReadInt32("GuildLevel", indexes);
                }
                if (changesMask[11])
                {
                    data.PartyType = packet.ReadByte("PartyType", indexes);
                }
                if (changesMask[12])
                {
                    data.NativeSex = packet.ReadByte("NativeSex", indexes);
                }
                if (changesMask[13])
                {
                    data.Inebriation = packet.ReadByte("Inebriation", indexes);
                }
                if (changesMask[14])
                {
                    data.PvpTitle = packet.ReadByte("PvpTitle", indexes);
                }
                if (changesMask[15])
                {
                    data.ArenaFaction = packet.ReadByte("ArenaFaction", indexes);
                }
                if (changesMask[16])
                {
                    data.PvpRank = packet.ReadByte("PvpRank", indexes);
                }
                if (changesMask[17])
                {
                    data.Unk254 = packet.ReadByte("Unk254", indexes);
                }
                if (changesMask[18])
                {
                    data.DuelTeam = packet.ReadUInt32("DuelTeam", indexes);
                }
                if (changesMask[19])
                {
                    data.GuildTimeStamp = packet.ReadInt32("GuildTimeStamp", indexes);
                }
                if (changesMask[20])
                {
                    data.PlayerTitle = packet.ReadInt32("PlayerTitle", indexes);
                }
                if (changesMask[21])
                {
                    data.FakeInebriation = packet.ReadInt32("FakeInebriation", indexes);
                }
                if (changesMask[22])
                {
                    data.VirtualPlayerRealm = packet.ReadUInt32("VirtualPlayerRealm", indexes);
                }
                if (changesMask[23])
                {
                    data.CurrentSpecID = packet.ReadUInt32("CurrentSpecID", indexes);
                }
                if (changesMask[24])
                {
                    data.TaxiMountAnimKitID = packet.ReadInt32("TaxiMountAnimKitID", indexes);
                }
                if (changesMask[25])
                {
                    data.CurrentBattlePetBreedQuality = packet.ReadByte("CurrentBattlePetBreedQuality", indexes);
                }
                if (changesMask[26])
                {
                    data.HonorLevel = packet.ReadInt32("HonorLevel", indexes);
                }
            }
            if (changesMask[27])
            {
                for (var i = 0; i < 25; ++i)
                {
                    if (changesMask[28 + i])
                    {
                        if (noQuestLogChangesMask)
                            data.QuestLog[i] = ReadCreateQuestLog(packet, indexes, "QuestLog", i);
                        else
                            data.QuestLog[i] = ReadUpdateQuestLog(packet, data.QuestLog[i] as QuestLog, indexes, "QuestLog", i);
                    }
                }
            }
            if (changesMask[53])
            {
                for (var i = 0; i < 19; ++i)
                {
                    if (changesMask[54 + i])
                    {
                        data.VisibleItems[i] = ReadUpdateVisibleItem(packet, data.VisibleItems[i] as VisibleItem, indexes, "VisibleItems", i);
                    }
                }
            }
            if (changesMask[73])
            {
                for (var i = 0; i < 6; ++i)
                {
                    if (changesMask[74 + i])
                    {
                        data.AvgItemLevel[i] = packet.ReadSingle("AvgItemLevel", indexes, i);
                    }
                }
            }
            return data;
        }

        public static ISkillInfo ReadCreateSkillInfo(Packet packet, params object[] indexes)
        {
            var data = new SkillInfo();
            for (var i = 0; i < 256; ++i)
            {
                data.SkillLineID[i] = packet.ReadUInt16("SkillLineID", indexes, i);
                data.SkillStep[i] = packet.ReadUInt16("SkillStep", indexes, i);
                data.SkillRank[i] = packet.ReadUInt16("SkillRank", indexes, i);
                data.SkillStartingRank[i] = packet.ReadUInt16("SkillStartingRank", indexes, i);
                data.SkillMaxRank[i] = packet.ReadUInt16("SkillMaxRank", indexes, i);
                data.SkillTempBonus[i] = packet.ReadInt16("SkillTempBonus", indexes, i);
                data.SkillPermBonus[i] = packet.ReadUInt16("SkillPermBonus", indexes, i);
            }
            return data;
        }

        public static ISkillInfo ReadUpdateSkillInfo(Packet packet, params object[] indexes)
        {
            var data = new SkillInfo();
            var rawChangesMask = new int[57];
            var rawMaskMask = new int[2];
            for (var i = 0; i < 1; ++i)
                rawMaskMask[i] = packet.ReadInt32();
            rawMaskMask[1] = (int)packet.ReadBits(25);
            var maskMask = new BitArray(rawMaskMask);
            for (var i = 0; i < 57; ++i)
                if (maskMask[i])
                    rawChangesMask[i] = (int)packet.ReadBits(32);
            var changesMask = new BitArray(rawChangesMask);

            packet.ResetBitReader();
            if (changesMask[0])
            {
                for (var i = 0; i < 256; ++i)
                {
                    if (changesMask[1 + i])
                    {
                        data.SkillLineID[i] = packet.ReadUInt16("SkillLineID", indexes, i);
                    }
                    if (changesMask[257 + i])
                    {
                        data.SkillStep[i] = packet.ReadUInt16("SkillStep", indexes, i);
                    }
                    if (changesMask[513 + i])
                    {
                        data.SkillRank[i] = packet.ReadUInt16("SkillRank", indexes, i);
                    }
                    if (changesMask[769 + i])
                    {
                        data.SkillStartingRank[i] = packet.ReadUInt16("SkillStartingRank", indexes, i);
                    }
                    if (changesMask[1025 + i])
                    {
                        data.SkillMaxRank[i] = packet.ReadUInt16("SkillMaxRank", indexes, i);
                    }
                    if (changesMask[1281 + i])
                    {
                        data.SkillTempBonus[i] = packet.ReadInt16("SkillTempBonus", indexes, i);
                    }
                    if (changesMask[1537 + i])
                    {
                        data.SkillPermBonus[i] = packet.ReadUInt16("SkillPermBonus", indexes, i);
                    }
                }
            }
            return data;
        }

        public static IRestInfo ReadCreateRestInfo(Packet packet, params object[] indexes)
        {
            var data = new RestInfo();
            data.Threshold = packet.ReadUInt32("Threshold", indexes);
            data.StateID = packet.ReadByte("StateID", indexes);
            return data;
        }

        public static IRestInfo ReadUpdateRestInfo(Packet packet, params object[] indexes)
        {
            var data = new RestInfo();
            var rawChangesMask = new int[1];
            rawChangesMask[0] = (int)packet.ReadBits(3);
            var changesMask = new BitArray(rawChangesMask);

            packet.ResetBitReader();
            if (changesMask[0])
            {
                if (changesMask[1])
                {
                    data.Threshold = packet.ReadUInt32("Threshold", indexes);
                }
                if (changesMask[2])
                {
                    data.StateID = packet.ReadByte("StateID", indexes);
                }
            }
            return data;
        }

        public static IPVPInfo ReadCreatePVPInfo(Packet packet, params object[] indexes)
        {
            var data = new PVPInfo();
            packet.ResetBitReader();
            data.WeeklyPlayed = packet.ReadUInt32("WeeklyPlayed", indexes);
            data.WeeklyWon = packet.ReadUInt32("WeeklyWon", indexes);
            data.SeasonPlayed = packet.ReadUInt32("SeasonPlayed", indexes);
            data.SeasonWon = packet.ReadUInt32("SeasonWon", indexes);
            data.Rating = packet.ReadUInt32("Rating", indexes);
            data.WeeklyBestRating = packet.ReadUInt32("WeeklyBestRating", indexes);
            data.SeasonBestRating = packet.ReadUInt32("SeasonBestRating", indexes);
            data.PvpTierID = packet.ReadUInt32("PvpTierID", indexes);
            data.WeeklyBestWinPvpTierID = packet.ReadUInt32("WeeklyBestWinPvpTierID", indexes);
            data.Field_28 = packet.ReadUInt32("Field_28", indexes);
            data.Field_2C = packet.ReadUInt32("Field_2C", indexes);
            data.Disqualified = packet.ReadBit("Disqualified", indexes);
            return data;
        }

        public static IPVPInfo ReadUpdatePVPInfo(Packet packet, params object[] indexes)
        {
            var data = new PVPInfo();
            packet.ResetBitReader();
            var rawChangesMask = new int[1];
            rawChangesMask[0] = (int)packet.ReadBits(13);
            var changesMask = new BitArray(rawChangesMask);

            if (changesMask[0])
            {
                if (changesMask[1])
                {
                    data.Disqualified = packet.ReadBit("Disqualified", indexes);
                }
            }
            packet.ResetBitReader();
            if (changesMask[0])
            {
                if (changesMask[2])
                {
                    data.WeeklyPlayed = packet.ReadUInt32("WeeklyPlayed", indexes);
                }
                if (changesMask[3])
                {
                    data.WeeklyWon = packet.ReadUInt32("WeeklyWon", indexes);
                }
                if (changesMask[4])
                {
                    data.SeasonPlayed = packet.ReadUInt32("SeasonPlayed", indexes);
                }
                if (changesMask[5])
                {
                    data.SeasonWon = packet.ReadUInt32("SeasonWon", indexes);
                }
                if (changesMask[6])
                {
                    data.Rating = packet.ReadUInt32("Rating", indexes);
                }
                if (changesMask[7])
                {
                    data.WeeklyBestRating = packet.ReadUInt32("WeeklyBestRating", indexes);
                }
                if (changesMask[8])
                {
                    data.SeasonBestRating = packet.ReadUInt32("SeasonBestRating", indexes);
                }
                if (changesMask[9])
                {
                    data.PvpTierID = packet.ReadUInt32("PvpTierID", indexes);
                }
                if (changesMask[10])
                {
                    data.WeeklyBestWinPvpTierID = packet.ReadUInt32("WeeklyBestWinPvpTierID", indexes);
                }
                if (changesMask[11])
                {
                    data.Field_28 = packet.ReadUInt32("Field_28", indexes);
                }
                if (changesMask[12])
                {
                    data.Field_2C = packet.ReadUInt32("Field_2C", indexes);
                }
            }
            return data;
        }

        public static ICharacterRestriction ReadCreateCharacterRestriction(Packet packet, params object[] indexes)
        {
            var data = new CharacterRestriction();
            packet.ResetBitReader();
            data.Field_0 = packet.ReadInt32("Field_0", indexes);
            data.Field_4 = packet.ReadInt32("Field_4", indexes);
            data.Field_8 = packet.ReadInt32("Field_8", indexes);
            data.Type = packet.ReadBits("Type", 5, indexes);
            return data;
        }

        public static ICharacterRestriction ReadUpdateCharacterRestriction(Packet packet, params object[] indexes)
        {
            var data = new CharacterRestriction();
            packet.ResetBitReader();
            data.Field_0 = packet.ReadInt32("Field_0", indexes);
            data.Field_4 = packet.ReadInt32("Field_4", indexes);
            data.Field_8 = packet.ReadInt32("Field_8", indexes);
            data.Type = packet.ReadBits("Type", 5, indexes);
            return data;
        }

        public static ISpellPctModByLabel ReadCreateSpellPctModByLabel(Packet packet, params object[] indexes)
        {
            var data = new SpellPctModByLabel();
            data.ModIndex = packet.ReadInt32("ModIndex", indexes);
            data.ModifierValue = packet.ReadSingle("ModifierValue", indexes);
            data.LabelID = packet.ReadInt32("LabelID", indexes);
            return data;
        }

        public static ISpellPctModByLabel ReadUpdateSpellPctModByLabel(Packet packet, params object[] indexes)
        {
            var data = new SpellPctModByLabel();
            data.ModIndex = packet.ReadInt32("ModIndex", indexes);
            data.ModifierValue = packet.ReadSingle("ModifierValue", indexes);
            data.LabelID = packet.ReadInt32("LabelID", indexes);
            return data;
        }

        public static ISpellFlatModByLabel ReadCreateSpellFlatModByLabel(Packet packet, params object[] indexes)
        {
            var data = new SpellFlatModByLabel();
            data.ModIndex = packet.ReadInt32("ModIndex", indexes);
            data.ModifierValue = packet.ReadInt32("ModifierValue", indexes);
            data.LabelID = packet.ReadInt32("LabelID", indexes);
            return data;
        }

        public static ISpellFlatModByLabel ReadUpdateSpellFlatModByLabel(Packet packet, params object[] indexes)
        {
            var data = new SpellFlatModByLabel();
            data.ModIndex = packet.ReadInt32("ModIndex", indexes);
            data.ModifierValue = packet.ReadInt32("ModifierValue", indexes);
            data.LabelID = packet.ReadInt32("LabelID", indexes);
            return data;
        }

        public static IResearch ReadCreateResearch(Packet packet, params object[] indexes)
        {
            var data = new Research();
            data.ResearchProjectID = packet.ReadInt16("ResearchProjectID", indexes);
            return data;
        }

        public static IResearch ReadUpdateResearch(Packet packet, params object[] indexes)
        {
            var data = new Research();
            data.ResearchProjectID = packet.ReadInt16("ResearchProjectID", indexes);
            return data;
        }

        public override IActivePlayerData ReadCreateActivePlayerData(Packet packet, UpdateFieldFlag flags, params object[] indexes)
        {
            var data = new ActivePlayerData();
            packet.ResetBitReader();
            for (var i = 0; i < 129; ++i)
            {
                data.InvSlots[i] = packet.ReadPackedGuid128("InvSlots", indexes, i);
            }
            data.FarsightObject = packet.ReadPackedGuid128("FarsightObject", indexes);
            data.ComboTarget = packet.ReadPackedGuid128("ComboTarget", indexes);
            data.SummonedBattlePetGUID = packet.ReadPackedGuid128("SummonedBattlePetGUID", indexes);
            data.KnownTitles.Resize(packet.ReadUInt32());
            data.Coinage = packet.ReadUInt64("Coinage", indexes);
            data.XP = packet.ReadInt32("XP", indexes);
            data.NextLevelXP = packet.ReadInt32("NextLevelXP", indexes);
            data.TrialXP = packet.ReadInt32("TrialXP", indexes);
            data.Skill = ReadCreateSkillInfo(packet, indexes, "Skill");
            data.CharacterPoints = packet.ReadInt32("CharacterPoints", indexes);
            data.MaxTalentTiers = packet.ReadInt32("MaxTalentTiers", indexes);
            data.TrackCreatureMask = packet.ReadUInt32("TrackCreatureMask", indexes);
            for (var i = 0; i < 2; ++i)
            {
                data.TrackResourceMask[i] = packet.ReadUInt32("TrackResourceMask", indexes, i);
            }
            data.MainhandExpertise = packet.ReadSingle("MainhandExpertise", indexes);
            data.OffhandExpertise = packet.ReadSingle("OffhandExpertise", indexes);
            data.RangedExpertise = packet.ReadSingle("RangedExpertise", indexes);
            data.CombatRatingExpertise = packet.ReadSingle("CombatRatingExpertise", indexes);
            data.BlockPercentage = packet.ReadSingle("BlockPercentage", indexes);
            data.DodgePercentage = packet.ReadSingle("DodgePercentage", indexes);
            data.DodgePercentageFromAttribute = packet.ReadSingle("DodgePercentageFromAttribute", indexes);
            data.ParryPercentage = packet.ReadSingle("ParryPercentage", indexes);
            data.ParryPercentageFromAttribute = packet.ReadSingle("ParryPercentageFromAttribute", indexes);
            data.CritPercentage = packet.ReadSingle("CritPercentage", indexes);
            data.RangedCritPercentage = packet.ReadSingle("RangedCritPercentage", indexes);
            data.OffhandCritPercentage = packet.ReadSingle("OffhandCritPercentage", indexes);
            for (var i = 0; i < 7; ++i)
            {
                data.SpellCritPercentage[i] = packet.ReadSingle("SpellCritPercentage", indexes, i);
                data.ModDamageDonePos[i] = packet.ReadInt32("ModDamageDonePos", indexes, i);
                data.ModDamageDoneNeg[i] = packet.ReadInt32("ModDamageDoneNeg", indexes, i);
                data.ModDamageDonePercent[i] = packet.ReadSingle("ModDamageDonePercent", indexes, i);
            }
            data.ShieldBlock = packet.ReadInt32("ShieldBlock", indexes);
            data.Mastery = packet.ReadSingle("Mastery", indexes);
            data.Speed = packet.ReadSingle("Speed", indexes);
            data.Avoidance = packet.ReadSingle("Avoidance", indexes);
            data.Sturdiness = packet.ReadSingle("Sturdiness", indexes);
            data.Versatility = packet.ReadInt32("Versatility", indexes);
            data.VersatilityBonus = packet.ReadSingle("VersatilityBonus", indexes);
            data.PvpPowerDamage = packet.ReadSingle("PvpPowerDamage", indexes);
            data.PvpPowerHealing = packet.ReadSingle("PvpPowerHealing", indexes);
            for (var i = 0; i < 240; ++i)
            {
                data.ExploredZones[i] = packet.ReadUInt64("ExploredZones", indexes, i);
            }
            for (var i = 0; i < 2; ++i)
            {
                data.RestInfo[i] = ReadCreateRestInfo(packet, indexes, "RestInfo", i);
            }
            data.ModHealingDonePos = packet.ReadInt32("ModHealingDonePos", indexes);
            data.ModHealingPercent = packet.ReadSingle("ModHealingPercent", indexes);
            data.ModHealingDonePercent = packet.ReadSingle("ModHealingDonePercent", indexes);
            data.ModPeriodicHealingDonePercent = packet.ReadSingle("ModPeriodicHealingDonePercent", indexes);
            for (var i = 0; i < 3; ++i)
            {
                data.WeaponDmgMultipliers[i] = packet.ReadSingle("WeaponDmgMultipliers", indexes, i);
                data.WeaponAtkSpeedMultipliers[i] = packet.ReadSingle("WeaponAtkSpeedMultipliers", indexes, i);
            }
            data.ModSpellPowerPercent = packet.ReadSingle("ModSpellPowerPercent", indexes);
            data.ModResiliencePercent = packet.ReadSingle("ModResiliencePercent", indexes);
            data.OverrideSpellPowerByAPPercent = packet.ReadSingle("OverrideSpellPowerByAPPercent", indexes);
            data.OverrideAPBySpellPowerPercent = packet.ReadSingle("OverrideAPBySpellPowerPercent", indexes);
            data.ModTargetResistance = packet.ReadInt32("ModTargetResistance", indexes);
            data.ModTargetPhysicalResistance = packet.ReadInt32("ModTargetPhysicalResistance", indexes);
            data.LocalFlags = packet.ReadUInt32("LocalFlags", indexes);
            data.GrantableLevels = packet.ReadByte("GrantableLevels", indexes);
            data.MultiActionBars = packet.ReadByte("MultiActionBars", indexes);
            data.LifetimeMaxRank = packet.ReadByte("LifetimeMaxRank", indexes);
            data.NumRespecs = packet.ReadByte("NumRespecs", indexes);
            data.AmmoID = packet.ReadInt32("AmmoID", indexes);
            data.PvpMedals = packet.ReadUInt32("PvpMedals", indexes);
            for (var i = 0; i < 12; ++i)
            {
                data.BuybackPrice[i] = packet.ReadUInt32("BuybackPrice", indexes, i);
                data.BuybackTimestamp[i] = packet.ReadInt64("BuybackTimestamp", indexes, i);
            }
            data.TodayHonorableKills = packet.ReadUInt16("TodayHonorableKills", indexes);
            data.TodayDishonorableKills = packet.ReadUInt16("TodayDishonorableKills", indexes);
            data.YesterdayHonorableKills = packet.ReadUInt16("YesterdayHonorableKills", indexes);
            data.YesterdayDishonorableKills = packet.ReadUInt16("YesterdayDishonorableKills", indexes);
            data.LastWeekHonorableKills = packet.ReadUInt16("LastWeekHonorableKills", indexes);
            data.LastWeekDishonorableKills = packet.ReadUInt16("LastWeekDishonorableKills", indexes);
            data.ThisWeekHonorableKills = packet.ReadUInt16("ThisWeekHonorableKills", indexes);
            data.ThisWeekDishonorableKills = packet.ReadUInt16("ThisWeekDishonorableKills", indexes);
            data.ThisWeekContribution = packet.ReadUInt32("ThisWeekContribution", indexes);
            data.LifetimeHonorableKills = packet.ReadUInt32("LifetimeHonorableKills", indexes);
            data.LifetimeDishonorableKills = packet.ReadUInt32("LifetimeDishonorableKills", indexes);
            data.YesterdayContribution = packet.ReadUInt32("YesterdayContribution", indexes);
            data.LastWeekContribution = packet.ReadUInt32("LastWeekContribution", indexes);
            data.LastWeekRank = packet.ReadUInt32("LastWeekRank", indexes);
            data.WatchedFactionIndex = packet.ReadInt32("WatchedFactionIndex", indexes);
            for (var i = 0; i < 32; ++i)
            {
                data.CombatRatings[i] = packet.ReadInt32("CombatRatings", indexes, i);
            }
            data.MaxLevel = packet.ReadInt32("MaxLevel", indexes);
            data.ScalingPlayerLevelDelta = packet.ReadInt32("ScalingPlayerLevelDelta", indexes);
            data.MaxCreatureScalingLevel = packet.ReadInt32("MaxCreatureScalingLevel", indexes);
            for (var i = 0; i < 4; ++i)
            {
                data.NoReagentCostMask[i] = packet.ReadUInt32("NoReagentCostMask", indexes, i);
            }
            data.PetSpellPower = packet.ReadInt32("PetSpellPower", indexes);
            for (var i = 0; i < 2; ++i)
            {
                data.ProfessionSkillLine[i] = packet.ReadInt32("ProfessionSkillLine", indexes, i);
            }
            data.UiHitModifier = packet.ReadSingle("UiHitModifier", indexes);
            data.UiSpellHitModifier = packet.ReadSingle("UiSpellHitModifier", indexes);
            data.HomeRealmTimeOffset = packet.ReadInt32("HomeRealmTimeOffset", indexes);
            data.ModPetHaste = packet.ReadSingle("ModPetHaste", indexes);
            data.LocalRegenFlags = packet.ReadByte("LocalRegenFlags", indexes);
            data.AuraVision = packet.ReadByte("AuraVision", indexes);
            data.NumBackpackSlots = packet.ReadByte("NumBackpackSlots", indexes);
            data.OverrideSpellsID = packet.ReadInt32("OverrideSpellsID", indexes);
            data.LfgBonusFactionID = packet.ReadInt32("LfgBonusFactionID", indexes);
            data.LootSpecID = packet.ReadUInt16("LootSpecID", indexes);
            data.OverrideZonePVPType = packet.ReadUInt32("OverrideZonePVPType", indexes);
            for (var i = 0; i < 4; ++i)
            {
                data.BagSlotFlags[i] = packet.ReadUInt32("BagSlotFlags", indexes, i);
            }
            for (var i = 0; i < 7; ++i)
            {
                data.BankBagSlotFlags[i] = packet.ReadUInt32("BankBagSlotFlags", indexes, i);
            }
            for (var i = 0; i < 875; ++i)
            {
                data.QuestCompleted[i] = packet.ReadUInt64("QuestCompleted", indexes, i);
            }
            data.Honor = packet.ReadInt32("Honor", indexes);
            data.HonorNextLevel = packet.ReadInt32("HonorNextLevel", indexes);
            data.PvpTierMaxFromWins = packet.ReadInt32("PvpTierMaxFromWins", indexes);
            data.PvpLastWeeksTierMaxFromWins = packet.ReadInt32("PvpLastWeeksTierMaxFromWins", indexes);
            data.NumBankSlots = packet.ReadByte("NumBankSlots", indexes);
            data.ResearchSites.Resize(packet.ReadUInt32());
            data.ResearchSiteProgress.Resize(packet.ReadUInt32());
            data.DailyQuestsCompleted.Resize(packet.ReadUInt32());
            data.AvailableQuestLineXQuestIDs.Resize(packet.ReadUInt32());
            data.Unk254.Resize(packet.ReadUInt32());
            data.Heirlooms.Resize(packet.ReadUInt32());
            data.HeirloomFlags.Resize(packet.ReadUInt32());
            data.Toys.Resize(packet.ReadUInt32());
            data.Transmog.Resize(packet.ReadUInt32());
            data.ConditionalTransmog.Resize(packet.ReadUInt32());
            data.SelfResSpells.Resize(packet.ReadUInt32());
            data.CharacterRestrictions.Resize(packet.ReadUInt32());
            data.SpellPctModByLabel.Resize(packet.ReadUInt32());
            data.SpellFlatModByLabel.Resize(packet.ReadUInt32());
            for (var i = 0; i < 1; ++i)
            {
                data.Research[i].Resize(packet.ReadUInt32());
                for (var j = 0; j < data.Research[i].Count; ++j)
                {
                    data.Research[i][j] = ReadCreateResearch(packet, indexes, "Research", i, j);
                }
            }
            data.TransportServerTime = packet.ReadInt32("TransportServerTime", indexes);
            for (var i = 0; i < data.KnownTitles.Count; ++i)
            {
                data.KnownTitles[i] = packet.ReadUInt64("KnownTitles", indexes, i);
            }
            for (var i = 0; i < data.ResearchSites.Count; ++i)
            {
                data.ResearchSites[i] = packet.ReadUInt32("ResearchSites", indexes, i);
            }
            for (var i = 0; i < data.ResearchSiteProgress.Count; ++i)
            {
                data.ResearchSiteProgress[i] = packet.ReadUInt32("ResearchSiteProgress", indexes, i);
            }
            for (var i = 0; i < data.DailyQuestsCompleted.Count; ++i)
            {
                data.DailyQuestsCompleted[i] = packet.ReadInt32("DailyQuestsCompleted", indexes, i);
            }
            for (var i = 0; i < data.AvailableQuestLineXQuestIDs.Count; ++i)
            {
                data.AvailableQuestLineXQuestIDs[i] = packet.ReadInt32("AvailableQuestLineXQuestIDs", indexes, i);
            }
            for (var i = 0; i < data.Unk254.Count; ++i)
            {
                data.Unk254[i] = packet.ReadInt32("Unk254", indexes, i);
            }
            for (var i = 0; i < data.Heirlooms.Count; ++i)
            {
                data.Heirlooms[i] = packet.ReadInt32("Heirlooms", indexes, i);
            }
            for (var i = 0; i < data.HeirloomFlags.Count; ++i)
            {
                data.HeirloomFlags[i] = packet.ReadUInt32("HeirloomFlags", indexes, i);
            }
            for (var i = 0; i < data.Toys.Count; ++i)
            {
                data.Toys[i] = packet.ReadInt32("Toys", indexes, i);
            }
            for (var i = 0; i < data.Transmog.Count; ++i)
            {
                data.Transmog[i] = packet.ReadUInt32("Transmog", indexes, i);
            }
            for (var i = 0; i < data.ConditionalTransmog.Count; ++i)
            {
                data.ConditionalTransmog[i] = packet.ReadInt32("ConditionalTransmog", indexes, i);
            }
            for (var i = 0; i < data.SelfResSpells.Count; ++i)
            {
                data.SelfResSpells[i] = packet.ReadInt32("SelfResSpells", indexes, i);
            }
            for (var i = 0; i < data.SpellPctModByLabel.Count; ++i)
            {
                data.SpellPctModByLabel[i] = ReadCreateSpellPctModByLabel(packet, indexes, "SpellPctModByLabel", i);
            }
            for (var i = 0; i < data.SpellFlatModByLabel.Count; ++i)
            {
                data.SpellFlatModByLabel[i] = ReadCreateSpellFlatModByLabel(packet, indexes, "SpellFlatModByLabel", i);
            }
            for (var i = 0; i < 6; ++i)
            {
                data.PvpInfo[i] = ReadCreatePVPInfo(packet, indexes, "PvpInfo", i);
            }
            packet.ResetBitReader();
            data.InsertItemsLeftToRight = packet.ReadBit("InsertItemsLeftToRight", indexes);
            for (var i = 0; i < data.CharacterRestrictions.Count; ++i)
            {
                data.CharacterRestrictions[i] = ReadCreateCharacterRestriction(packet, indexes, "CharacterRestrictions", i);
            }
            return data;
        }

        public override IActivePlayerData ReadUpdateActivePlayerData(Packet packet, params object[] indexes)
        {
            var data = new ActivePlayerData();
            packet.ResetBitReader();
            var rawChangesMask = new int[47];
            var rawMaskMask = new int[2];
            for (var i = 0; i < 1; ++i)
                rawMaskMask[i] = packet.ReadInt32();
            rawMaskMask[1] = (int)packet.ReadBits(15);
            var maskMask = new BitArray(rawMaskMask);
            for (var i = 0; i < 47; ++i)
                if (maskMask[i])
                    rawChangesMask[i] = (int)packet.ReadBits(32);
            var changesMask = new BitArray(rawChangesMask);

            if (changesMask[0])
            {
                if (changesMask[1])
                {
                    data.InsertItemsLeftToRight = packet.ReadBit("InsertItemsLeftToRight", indexes);
                }
                if (changesMask[2])
                {
                    data.KnownTitles.ReadUpdateMask(packet);
                }
                if (changesMask[3])
                {
                    data.ResearchSites.ReadUpdateMask(packet);
                }
                if (changesMask[4])
                {
                    data.ResearchSiteProgress.ReadUpdateMask(packet);
                }
                if (changesMask[5])
                {
                    data.DailyQuestsCompleted.ReadUpdateMask(packet);
                }
                if (changesMask[6])
                {
                    data.AvailableQuestLineXQuestIDs.ReadUpdateMask(packet);
                }
                if (changesMask[7])
                {
                    data.Unk254.ReadUpdateMask(packet);
                }
                if (changesMask[8])
                {
                    data.Heirlooms.ReadUpdateMask(packet);
                }
                if (changesMask[9])
                {
                    data.HeirloomFlags.ReadUpdateMask(packet);
                }
                if (changesMask[10])
                {
                    data.Toys.ReadUpdateMask(packet);
                }
                if (changesMask[11])
                {
                    data.Transmog.ReadUpdateMask(packet);
                }
                if (changesMask[12])
                {
                    data.ConditionalTransmog.ReadUpdateMask(packet);
                }
                if (changesMask[13])
                {
                    data.SelfResSpells.ReadUpdateMask(packet);
                }
                if (changesMask[14])
                {
                    data.CharacterRestrictions.ReadUpdateMask(packet);
                }
                if (changesMask[15])
                {
                    data.SpellPctModByLabel.ReadUpdateMask(packet);
                }
                if (changesMask[16])
                {
                    data.SpellFlatModByLabel.ReadUpdateMask(packet);
                }
            }
            if (changesMask[17])
            {
                for (var i = 0; i < 1; ++i)
                {
                    if (changesMask[18 + i])
                    {
                        data.Research[i].ReadUpdateMask(packet);
                        for (var j = 0; j < data.Research[i].Count; ++j)
                        {
                            if (data.Research[i].UpdateMask[j])
                            {
                                data.Research[i][j] = ReadUpdateResearch(packet, data.Research[i][j] as Research, indexes, "Research", i, j);
                            }
                        }
                    }
                }
            }
            packet.ResetBitReader();
            packet.ResetBitReader();
            if (changesMask[0])
            {
                if (changesMask[2])
                {
                    for (var i = 0; i < data.KnownTitles.Count; ++i)
                    {
                        if (data.KnownTitles.UpdateMask[i])
                        {
                            data.KnownTitles[i] = packet.ReadUInt64("KnownTitles", indexes, i);
                        }
                    }
                }
                if (changesMask[3])
                {
                    for (var i = 0; i < data.ResearchSites.Count; ++i)
                    {
                        if (data.ResearchSites.UpdateMask[i])
                        {
                            data.ResearchSites[i] = packet.ReadUInt32("ResearchSites", indexes, i);
                        }
                    }
                }
                if (changesMask[4])
                {
                    for (var i = 0; i < data.ResearchSiteProgress.Count; ++i)
                    {
                        if (data.ResearchSiteProgress.UpdateMask[i])
                        {
                            data.ResearchSiteProgress[i] = packet.ReadUInt32("ResearchSiteProgress", indexes, i);
                        }
                    }
                }
                if (changesMask[5])
                {
                    for (var i = 0; i < data.DailyQuestsCompleted.Count; ++i)
                    {
                        if (data.DailyQuestsCompleted.UpdateMask[i])
                        {
                            data.DailyQuestsCompleted[i] = packet.ReadInt32("DailyQuestsCompleted", indexes, i);
                        }
                    }
                }
                if (changesMask[6])
                {
                    for (var i = 0; i < data.AvailableQuestLineXQuestIDs.Count; ++i)
                    {
                        if (data.AvailableQuestLineXQuestIDs.UpdateMask[i])
                        {
                            data.AvailableQuestLineXQuestIDs[i] = packet.ReadInt32("AvailableQuestLineXQuestIDs", indexes, i);
                        }
                    }
                }
                if (changesMask[7])
                {
                    for (var i = 0; i < data.Unk254.Count; ++i)
                    {
                        if (data.Unk254.UpdateMask[i])
                        {
                            data.Unk254[i] = packet.ReadInt32("Unk254", indexes, i);
                        }
                    }
                }
                if (changesMask[8])
                {
                    for (var i = 0; i < data.Heirlooms.Count; ++i)
                    {
                        if (data.Heirlooms.UpdateMask[i])
                        {
                            data.Heirlooms[i] = packet.ReadInt32("Heirlooms", indexes, i);
                        }
                    }
                }
                if (changesMask[9])
                {
                    for (var i = 0; i < data.HeirloomFlags.Count; ++i)
                    {
                        if (data.HeirloomFlags.UpdateMask[i])
                        {
                            data.HeirloomFlags[i] = packet.ReadUInt32("HeirloomFlags", indexes, i);
                        }
                    }
                }
                if (changesMask[10])
                {
                    for (var i = 0; i < data.Toys.Count; ++i)
                    {
                        if (data.Toys.UpdateMask[i])
                        {
                            data.Toys[i] = packet.ReadInt32("Toys", indexes, i);
                        }
                    }
                }
                if (changesMask[11])
                {
                    for (var i = 0; i < data.Transmog.Count; ++i)
                    {
                        if (data.Transmog.UpdateMask[i])
                        {
                            data.Transmog[i] = packet.ReadUInt32("Transmog", indexes, i);
                        }
                    }
                }
                if (changesMask[12])
                {
                    for (var i = 0; i < data.ConditionalTransmog.Count; ++i)
                    {
                        if (data.ConditionalTransmog.UpdateMask[i])
                        {
                            data.ConditionalTransmog[i] = packet.ReadInt32("ConditionalTransmog", indexes, i);
                        }
                    }
                }
                if (changesMask[13])
                {
                    for (var i = 0; i < data.SelfResSpells.Count; ++i)
                    {
                        if (data.SelfResSpells.UpdateMask[i])
                        {
                            data.SelfResSpells[i] = packet.ReadInt32("SelfResSpells", indexes, i);
                        }
                    }
                }
                if (changesMask[15])
                {
                    for (var i = 0; i < data.SpellPctModByLabel.Count; ++i)
                    {
                        if (data.SpellPctModByLabel.UpdateMask[i])
                        {
                            data.SpellPctModByLabel[i] = ReadUpdateSpellPctModByLabel(packet, data.SpellPctModByLabel[i] as SpellPctModByLabel, indexes, "SpellPctModByLabel", i);
                        }
                    }
                }
                if (changesMask[16])
                {
                    for (var i = 0; i < data.SpellFlatModByLabel.Count; ++i)
                    {
                        if (data.SpellFlatModByLabel.UpdateMask[i])
                        {
                            data.SpellFlatModByLabel[i] = ReadUpdateSpellFlatModByLabel(packet, data.SpellFlatModByLabel[i] as SpellFlatModByLabel, indexes, "SpellFlatModByLabel", i);
                        }
                    }
                }
                if (changesMask[14])
                {
                    for (var i = 0; i < data.CharacterRestrictions.Count; ++i)
                    {
                        if (data.CharacterRestrictions.UpdateMask[i])
                        {
                            data.CharacterRestrictions[i] = ReadUpdateCharacterRestriction(packet, data.CharacterRestrictions[i] as CharacterRestriction, indexes, "CharacterRestrictions", i);
                        }
                    }
                }
                if (changesMask[19])
                {
                    data.FarsightObject = packet.ReadPackedGuid128("FarsightObject", indexes);
                }
                if (changesMask[20])
                {
                    data.ComboTarget = packet.ReadPackedGuid128("ComboTarget", indexes);
                }
                if (changesMask[21])
                {
                    data.SummonedBattlePetGUID = packet.ReadPackedGuid128("SummonedBattlePetGUID", indexes);
                }
                if (changesMask[22])
                {
                    data.Coinage = packet.ReadUInt64("Coinage", indexes);
                }
                if (changesMask[23])
                {
                    data.XP = packet.ReadInt32("XP", indexes);
                }
                if (changesMask[24])
                {
                    data.NextLevelXP = packet.ReadInt32("NextLevelXP", indexes);
                }
                if (changesMask[25])
                {
                    data.TrialXP = packet.ReadInt32("TrialXP", indexes);
                }
                if (changesMask[26])
                {
                    data.Skill = ReadUpdateSkillInfo(packet, data.Skill as SkillInfo, indexes, "Skill");
                }
                if (changesMask[27])
                {
                    data.CharacterPoints = packet.ReadInt32("CharacterPoints", indexes);
                }
                if (changesMask[28])
                {
                    data.MaxTalentTiers = packet.ReadInt32("MaxTalentTiers", indexes);
                }
                if (changesMask[29])
                {
                    data.TrackCreatureMask = packet.ReadUInt32("TrackCreatureMask", indexes);
                }
                if (changesMask[30])
                {
                    data.MainhandExpertise = packet.ReadSingle("MainhandExpertise", indexes);
                }
                if (changesMask[31])
                {
                    data.OffhandExpertise = packet.ReadSingle("OffhandExpertise", indexes);
                }
                if (changesMask[32])
                {
                    data.RangedExpertise = packet.ReadSingle("RangedExpertise", indexes);
                }
                if (changesMask[33])
                {
                    data.CombatRatingExpertise = packet.ReadSingle("CombatRatingExpertise", indexes);
                }
            }
            if (changesMask[34])
            {
                if (changesMask[35])
                {
                    data.BlockPercentage = packet.ReadSingle("BlockPercentage", indexes);
                }
                if (changesMask[36])
                {
                    data.DodgePercentage = packet.ReadSingle("DodgePercentage", indexes);
                }
                if (changesMask[37])
                {
                    data.DodgePercentageFromAttribute = packet.ReadSingle("DodgePercentageFromAttribute", indexes);
                }
                if (changesMask[38])
                {
                    data.ParryPercentage = packet.ReadSingle("ParryPercentage", indexes);
                }
                if (changesMask[39])
                {
                    data.ParryPercentageFromAttribute = packet.ReadSingle("ParryPercentageFromAttribute", indexes);
                }
                if (changesMask[40])
                {
                    data.CritPercentage = packet.ReadSingle("CritPercentage", indexes);
                }
                if (changesMask[41])
                {
                    data.RangedCritPercentage = packet.ReadSingle("RangedCritPercentage", indexes);
                }
                if (changesMask[42])
                {
                    data.OffhandCritPercentage = packet.ReadSingle("OffhandCritPercentage", indexes);
                }
                if (changesMask[43])
                {
                    data.ShieldBlock = packet.ReadInt32("ShieldBlock", indexes);
                }
                if (changesMask[44])
                {
                    data.Mastery = packet.ReadSingle("Mastery", indexes);
                }
                if (changesMask[45])
                {
                    data.Speed = packet.ReadSingle("Speed", indexes);
                }
                if (changesMask[46])
                {
                    data.Avoidance = packet.ReadSingle("Avoidance", indexes);
                }
                if (changesMask[47])
                {
                    data.Sturdiness = packet.ReadSingle("Sturdiness", indexes);
                }
                if (changesMask[48])
                {
                    data.Versatility = packet.ReadInt32("Versatility", indexes);
                }
                if (changesMask[49])
                {
                    data.VersatilityBonus = packet.ReadSingle("VersatilityBonus", indexes);
                }
                if (changesMask[50])
                {
                    data.PvpPowerDamage = packet.ReadSingle("PvpPowerDamage", indexes);
                }
                if (changesMask[51])
                {
                    data.PvpPowerHealing = packet.ReadSingle("PvpPowerHealing", indexes);
                }
                if (changesMask[52])
                {
                    data.ModHealingDonePos = packet.ReadInt32("ModHealingDonePos", indexes);
                }
                if (changesMask[53])
                {
                    data.ModHealingPercent = packet.ReadSingle("ModHealingPercent", indexes);
                }
                if (changesMask[54])
                {
                    data.ModHealingDonePercent = packet.ReadSingle("ModHealingDonePercent", indexes);
                }
                if (changesMask[55])
                {
                    data.ModPeriodicHealingDonePercent = packet.ReadSingle("ModPeriodicHealingDonePercent", indexes);
                }
                if (changesMask[56])
                {
                    data.ModSpellPowerPercent = packet.ReadSingle("ModSpellPowerPercent", indexes);
                }
                if (changesMask[57])
                {
                    data.ModResiliencePercent = packet.ReadSingle("ModResiliencePercent", indexes);
                }
                if (changesMask[58])
                {
                    data.OverrideSpellPowerByAPPercent = packet.ReadSingle("OverrideSpellPowerByAPPercent", indexes);
                }
                if (changesMask[59])
                {
                    data.OverrideAPBySpellPowerPercent = packet.ReadSingle("OverrideAPBySpellPowerPercent", indexes);
                }
                if (changesMask[60])
                {
                    data.ModTargetResistance = packet.ReadInt32("ModTargetResistance", indexes);
                }
                if (changesMask[61])
                {
                    data.ModTargetPhysicalResistance = packet.ReadInt32("ModTargetPhysicalResistance", indexes);
                }
                if (changesMask[62])
                {
                    data.LocalFlags = packet.ReadUInt32("LocalFlags", indexes);
                }
                if (changesMask[63])
                {
                    data.GrantableLevels = packet.ReadByte("GrantableLevels", indexes);
                }
                if (changesMask[64])
                {
                    data.MultiActionBars = packet.ReadByte("MultiActionBars", indexes);
                }
                if (changesMask[65])
                {
                    data.LifetimeMaxRank = packet.ReadByte("LifetimeMaxRank", indexes);
                }
            }
            if (changesMask[66])
            {
                if (changesMask[67])
                {
                    data.NumRespecs = packet.ReadByte("NumRespecs", indexes);
                }
                if (changesMask[68])
                {
                    data.AmmoID = packet.ReadInt32("AmmoID", indexes);
                }
                if (changesMask[69])
                {
                    data.PvpMedals = packet.ReadUInt32("PvpMedals", indexes);
                }
                if (changesMask[70])
                {
                    data.TodayHonorableKills = packet.ReadUInt16("TodayHonorableKills", indexes);
                }
                if (changesMask[71])
                {
                    data.TodayDishonorableKills = packet.ReadUInt16("TodayDishonorableKills", indexes);
                }
                if (changesMask[72])
                {
                    data.YesterdayHonorableKills = packet.ReadUInt16("YesterdayHonorableKills", indexes);
                }
                if (changesMask[73])
                {
                    data.YesterdayDishonorableKills = packet.ReadUInt16("YesterdayDishonorableKills", indexes);
                }
                if (changesMask[74])
                {
                    data.LastWeekHonorableKills = packet.ReadUInt16("LastWeekHonorableKills", indexes);
                }
                if (changesMask[75])
                {
                    data.LastWeekDishonorableKills = packet.ReadUInt16("LastWeekDishonorableKills", indexes);
                }
                if (changesMask[76])
                {
                    data.ThisWeekHonorableKills = packet.ReadUInt16("ThisWeekHonorableKills", indexes);
                }
                if (changesMask[77])
                {
                    data.ThisWeekDishonorableKills = packet.ReadUInt16("ThisWeekDishonorableKills", indexes);
                }
                if (changesMask[78])
                {
                    data.ThisWeekContribution = packet.ReadUInt32("ThisWeekContribution", indexes);
                }
                if (changesMask[79])
                {
                    data.LifetimeHonorableKills = packet.ReadUInt32("LifetimeHonorableKills", indexes);
                }
                if (changesMask[80])
                {
                    data.LifetimeDishonorableKills = packet.ReadUInt32("LifetimeDishonorableKills", indexes);
                }
                if (changesMask[81])
                {
                    data.YesterdayContribution = packet.ReadUInt32("YesterdayContribution", indexes);
                }
                if (changesMask[82])
                {
                    data.LastWeekContribution = packet.ReadUInt32("LastWeekContribution", indexes);
                }
                if (changesMask[83])
                {
                    data.LastWeekRank = packet.ReadUInt32("LastWeekRank", indexes);
                }
                if (changesMask[84])
                {
                    data.WatchedFactionIndex = packet.ReadInt32("WatchedFactionIndex", indexes);
                }
                if (changesMask[85])
                {
                    data.MaxLevel = packet.ReadInt32("MaxLevel", indexes);
                }
                if (changesMask[86])
                {
                    data.ScalingPlayerLevelDelta = packet.ReadInt32("ScalingPlayerLevelDelta", indexes);
                }
                if (changesMask[87])
                {
                    data.MaxCreatureScalingLevel = packet.ReadInt32("MaxCreatureScalingLevel", indexes);
                }
                if (changesMask[88])
                {
                    data.PetSpellPower = packet.ReadInt32("PetSpellPower", indexes);
                }
                if (changesMask[89])
                {
                    data.UiHitModifier = packet.ReadSingle("UiHitModifier", indexes);
                }
                if (changesMask[90])
                {
                    data.UiSpellHitModifier = packet.ReadSingle("UiSpellHitModifier", indexes);
                }
                if (changesMask[91])
                {
                    data.HomeRealmTimeOffset = packet.ReadInt32("HomeRealmTimeOffset", indexes);
                }
                if (changesMask[92])
                {
                    data.ModPetHaste = packet.ReadSingle("ModPetHaste", indexes);
                }
                if (changesMask[93])
                {
                    data.LocalRegenFlags = packet.ReadByte("LocalRegenFlags", indexes);
                }
                if (changesMask[94])
                {
                    data.AuraVision = packet.ReadByte("AuraVision", indexes);
                }
                if (changesMask[95])
                {
                    data.NumBackpackSlots = packet.ReadByte("NumBackpackSlots", indexes);
                }
                if (changesMask[96])
                {
                    data.OverrideSpellsID = packet.ReadInt32("OverrideSpellsID", indexes);
                }
                if (changesMask[97])
                {
                    data.LfgBonusFactionID = packet.ReadInt32("LfgBonusFactionID", indexes);
                }
            }
            if (changesMask[98])
            {
                if (changesMask[99])
                {
                    data.LootSpecID = packet.ReadUInt16("LootSpecID", indexes);
                }
                if (changesMask[100])
                {
                    data.OverrideZonePVPType = packet.ReadUInt32("OverrideZonePVPType", indexes);
                }
                if (changesMask[101])
                {
                    data.Honor = packet.ReadInt32("Honor", indexes);
                }
                if (changesMask[102])
                {
                    data.HonorNextLevel = packet.ReadInt32("HonorNextLevel", indexes);
                }
                if (changesMask[103])
                {
                    data.PvpTierMaxFromWins = packet.ReadInt32("PvpTierMaxFromWins", indexes);
                }
                if (changesMask[104])
                {
                    data.PvpLastWeeksTierMaxFromWins = packet.ReadInt32("PvpLastWeeksTierMaxFromWins", indexes);
                }
                if (changesMask[105])
                {
                    data.NumBankSlots = packet.ReadByte("NumBankSlots", indexes);
                }
                if (changesMask[106])
                {
                    data.TransportServerTime = packet.ReadInt32("TransportServerTime", indexes);
                }
            }
            if (changesMask[107])
            {
                for (var i = 0; i < 129; ++i)
                {
                    if (changesMask[108 + i])
                    {
                        data.InvSlots[i] = packet.ReadPackedGuid128("InvSlots", indexes, i);
                    }
                }
            }
            if (changesMask[237])
            {
                for (var i = 0; i < 2; ++i)
                {
                    if (changesMask[238 + i])
                    {
                        data.TrackResourceMask[i] = packet.ReadUInt32("TrackResourceMask", indexes, i);
                    }
                }
            }
            if (changesMask[240])
            {
                for (var i = 0; i < 7; ++i)
                {
                    if (changesMask[241 + i])
                    {
                        data.SpellCritPercentage[i] = packet.ReadSingle("SpellCritPercentage", indexes, i);
                    }
                    if (changesMask[248 + i])
                    {
                        data.ModDamageDonePos[i] = packet.ReadInt32("ModDamageDonePos", indexes, i);
                    }
                    if (changesMask[255 + i])
                    {
                        data.ModDamageDoneNeg[i] = packet.ReadInt32("ModDamageDoneNeg", indexes, i);
                    }
                    if (changesMask[262 + i])
                    {
                        data.ModDamageDonePercent[i] = packet.ReadSingle("ModDamageDonePercent", indexes, i);
                    }
                }
            }
            if (changesMask[269])
            {
                for (var i = 0; i < 240; ++i)
                {
                    if (changesMask[270 + i])
                    {
                        data.ExploredZones[i] = packet.ReadUInt64("ExploredZones", indexes, i);
                    }
                }
            }
            if (changesMask[510])
            {
                for (var i = 0; i < 2; ++i)
                {
                    if (changesMask[511 + i])
                    {
                        data.RestInfo[i] = ReadUpdateRestInfo(packet, data.RestInfo[i] as RestInfo, indexes, "RestInfo", i);
                    }
                }
            }
            if (changesMask[513])
            {
                for (var i = 0; i < 3; ++i)
                {
                    if (changesMask[514 + i])
                    {
                        data.WeaponDmgMultipliers[i] = packet.ReadSingle("WeaponDmgMultipliers", indexes, i);
                    }
                    if (changesMask[517 + i])
                    {
                        data.WeaponAtkSpeedMultipliers[i] = packet.ReadSingle("WeaponAtkSpeedMultipliers", indexes, i);
                    }
                }
            }
            if (changesMask[520])
            {
                for (var i = 0; i < 12; ++i)
                {
                    if (changesMask[521 + i])
                    {
                        data.BuybackPrice[i] = packet.ReadUInt32("BuybackPrice", indexes, i);
                    }
                    if (changesMask[533 + i])
                    {
                        data.BuybackTimestamp[i] = packet.ReadInt64("BuybackTimestamp", indexes, i);
                    }
                }
            }
            if (changesMask[545])
            {
                for (var i = 0; i < 32; ++i)
                {
                    if (changesMask[546 + i])
                    {
                        data.CombatRatings[i] = packet.ReadInt32("CombatRatings", indexes, i);
                    }
                }
            }
            if (changesMask[585])
            {
                for (var i = 0; i < 4; ++i)
                {
                    if (changesMask[586 + i])
                    {
                        data.NoReagentCostMask[i] = packet.ReadUInt32("NoReagentCostMask", indexes, i);
                    }
                }
            }
            if (changesMask[590])
            {
                for (var i = 0; i < 2; ++i)
                {
                    if (changesMask[591 + i])
                    {
                        data.ProfessionSkillLine[i] = packet.ReadInt32("ProfessionSkillLine", indexes, i);
                    }
                }
            }
            if (changesMask[593])
            {
                for (var i = 0; i < 4; ++i)
                {
                    if (changesMask[594 + i])
                    {
                        data.BagSlotFlags[i] = packet.ReadUInt32("BagSlotFlags", indexes, i);
                    }
                }
            }
            if (changesMask[598])
            {
                for (var i = 0; i < 7; ++i)
                {
                    if (changesMask[599 + i])
                    {
                        data.BankBagSlotFlags[i] = packet.ReadUInt32("BankBagSlotFlags", indexes, i);
                    }
                }
            }
            if (changesMask[606])
            {
                for (var i = 0; i < 875; ++i)
                {
                    if (changesMask[607 + i])
                    {
                        data.QuestCompleted[i] = packet.ReadUInt64("QuestCompleted", indexes, i);
                    }
                }
            }
            if (changesMask[578])
            {
                for (var i = 0; i < 6; ++i)
                {
                    if (changesMask[579 + i])
                    {
                        data.PvpInfo[i] = ReadUpdatePVPInfo(packet, data.PvpInfo[i] as PVPInfo, indexes, "PvpInfo", i);
                    }
                }
            }
            return data;
        }

        public override IGameObjectData ReadCreateGameObjectData(Packet packet, UpdateFieldFlag flags, params object[] indexes)
        {
            var data = new GameObjectData();
            data.DisplayID = packet.ReadInt32("DisplayID", indexes);
            data.SpellVisualID = packet.ReadUInt32("SpellVisualID", indexes);
            data.StateSpellVisualID = packet.ReadUInt32("StateSpellVisualID", indexes);
            data.SpawnTrackingStateAnimID = packet.ReadUInt32("SpawnTrackingStateAnimID", indexes);
            data.SpawnTrackingStateAnimKitID = packet.ReadUInt32("SpawnTrackingStateAnimKitID", indexes);
            data.StateWorldEffectIDs = new System.Nullable<uint>[packet.ReadUInt32()];
            for (var i = 0; i < data.StateWorldEffectIDs.Length; ++i)
            {
                data.StateWorldEffectIDs[i] = packet.ReadUInt32("StateWorldEffectIDs", indexes, i);
            }
            data.CreatedBy = packet.ReadPackedGuid128("CreatedBy", indexes);
            data.GuildGUID = packet.ReadPackedGuid128("GuildGUID", indexes);
            data.Flags = packet.ReadUInt32("Flags", indexes);
            data.ParentRotation = packet.ReadQuaternion("ParentRotation", indexes);
            data.FactionTemplate = packet.ReadInt32("FactionTemplate", indexes);
            data.Level = packet.ReadInt32("Level", indexes);
            data.State = packet.ReadSByte("State", indexes);
            data.TypeID = packet.ReadSByte("TypeID", indexes);
            data.PercentHealth = packet.ReadByte("PercentHealth", indexes);
            data.ArtKit = packet.ReadUInt32("ArtKit", indexes);
            data.EnableDoodadSets.Resize(packet.ReadUInt32());
            data.CustomParam = packet.ReadUInt32("CustomParam", indexes);
            for (var i = 0; i < data.EnableDoodadSets.Count; ++i)
            {
                data.EnableDoodadSets[i] = packet.ReadInt32("EnableDoodadSets", indexes, i);
            }
            return data;
        }

        public override IGameObjectData ReadUpdateGameObjectData(Packet packet, params object[] indexes)
        {
            var data = new GameObjectData();
            var rawChangesMask = new int[1];
            rawChangesMask[0] = (int)packet.ReadBits(19);
            var changesMask = new BitArray(rawChangesMask);

            if (changesMask[0])
            {
                if (changesMask[1])
                {
                    data.StateWorldEffectIDs = Enumerable.Range(0, (int)packet.ReadBits(32)).Select(x => new uint()).Cast<System.Nullable<uint>>().ToArray();
                    for (var i = 0; i < data.StateWorldEffectIDs.Length; ++i)
                    {
                        data.StateWorldEffectIDs[i] = packet.ReadUInt32("StateWorldEffectIDs", indexes, i);
                    }
                }
            }
            packet.ResetBitReader();
            if (changesMask[0])
            {
                if (changesMask[2])
                {
                    data.EnableDoodadSets.ReadUpdateMask(packet);
                }
            }
            packet.ResetBitReader();
            if (changesMask[0])
            {
                if (changesMask[2])
                {
                    for (var i = 0; i < data.EnableDoodadSets.Count; ++i)
                    {
                        if (data.EnableDoodadSets.UpdateMask[i])
                        {
                            data.EnableDoodadSets[i] = packet.ReadInt32("EnableDoodadSets", indexes, i);
                        }
                    }
                }
                if (changesMask[3])
                {
                    data.DisplayID = packet.ReadInt32("DisplayID", indexes);
                }
                if (changesMask[4])
                {
                    data.SpellVisualID = packet.ReadUInt32("SpellVisualID", indexes);
                }
                if (changesMask[5])
                {
                    data.StateSpellVisualID = packet.ReadUInt32("StateSpellVisualID", indexes);
                }
                if (changesMask[6])
                {
                    data.SpawnTrackingStateAnimID = packet.ReadUInt32("SpawnTrackingStateAnimID", indexes);
                }
                if (changesMask[7])
                {
                    data.SpawnTrackingStateAnimKitID = packet.ReadUInt32("SpawnTrackingStateAnimKitID", indexes);
                }
                if (changesMask[8])
                {
                    data.CreatedBy = packet.ReadPackedGuid128("CreatedBy", indexes);
                }
                if (changesMask[9])
                {
                    data.GuildGUID = packet.ReadPackedGuid128("GuildGUID", indexes);
                }
                if (changesMask[10])
                {
                    data.Flags = packet.ReadUInt32("Flags", indexes);
                }
                if (changesMask[11])
                {
                    data.ParentRotation = packet.ReadQuaternion("ParentRotation", indexes);
                }
                if (changesMask[12])
                {
                    data.FactionTemplate = packet.ReadInt32("FactionTemplate", indexes);
                }
                if (changesMask[13])
                {
                    data.Level = packet.ReadInt32("Level", indexes);
                }
                if (changesMask[14])
                {
                    data.State = packet.ReadSByte("State", indexes);
                }
                if (changesMask[15])
                {
                    data.TypeID = packet.ReadSByte("TypeID", indexes);
                }
                if (changesMask[16])
                {
                    data.PercentHealth = packet.ReadByte("PercentHealth", indexes);
                }
                if (changesMask[17])
                {
                    data.ArtKit = packet.ReadUInt32("ArtKit", indexes);
                }
                if (changesMask[18])
                {
                    data.CustomParam = packet.ReadUInt32("CustomParam", indexes);
                }
            }
            return data;
        }

        public override IDynamicObjectData ReadCreateDynamicObjectData(Packet packet, UpdateFieldFlag flags, params object[] indexes)
        {
            var data = new DynamicObjectData();
            data.Caster = packet.ReadPackedGuid128("Caster", indexes);
            data.Type = packet.ReadByte("Type", indexes);
            data.SpellXSpellVisualID = packet.ReadInt32("SpellXSpellVisualID", indexes);
            data.SpellID = packet.ReadInt32("SpellID", indexes);
            data.Radius = packet.ReadSingle("Radius", indexes);
            data.CastTime = packet.ReadUInt32("CastTime", indexes);
            return data;
        }

        public override IDynamicObjectData ReadUpdateDynamicObjectData(Packet packet, params object[] indexes)
        {
            var data = new DynamicObjectData();
            var rawChangesMask = new int[1];
            rawChangesMask[0] = (int)packet.ReadBits(7);
            var changesMask = new BitArray(rawChangesMask);

            packet.ResetBitReader();
            if (changesMask[0])
            {
                if (changesMask[1])
                {
                    data.Caster = packet.ReadPackedGuid128("Caster", indexes);
                }
                if (changesMask[2])
                {
                    data.Type = packet.ReadByte("Type", indexes);
                }
                if (changesMask[3])
                {
                    data.SpellXSpellVisualID = packet.ReadInt32("SpellXSpellVisualID", indexes);
                }
                if (changesMask[4])
                {
                    data.SpellID = packet.ReadInt32("SpellID", indexes);
                }
                if (changesMask[5])
                {
                    data.Radius = packet.ReadSingle("Radius", indexes);
                }
                if (changesMask[6])
                {
                    data.CastTime = packet.ReadUInt32("CastTime", indexes);
                }
            }
            return data;
        }

        public override ICorpseData ReadCreateCorpseData(Packet packet, UpdateFieldFlag flags, params object[] indexes)
        {
            var data = new CorpseData();
            data.DynamicFlags = packet.ReadUInt32("DynamicFlags", indexes);
            data.Owner = packet.ReadPackedGuid128("Owner", indexes);
            data.PartyGUID = packet.ReadPackedGuid128("PartyGUID", indexes);
            data.GuildGUID = packet.ReadPackedGuid128("GuildGUID", indexes);
            data.DisplayID = packet.ReadUInt32("DisplayID", indexes);
            for (var i = 0; i < 19; ++i)
            {
                data.Items[i] = packet.ReadUInt32("Items", indexes, i);
            }
            data.RaceID = packet.ReadByte("RaceID", indexes);
            data.Sex = packet.ReadByte("Sex", indexes);
            data.Class = packet.ReadByte("Class", indexes);
            data.Customizations.Resize(packet.ReadUInt32());
            data.Flags = packet.ReadUInt32("Flags", indexes);
            data.FactionTemplate = packet.ReadInt32("FactionTemplate", indexes);
            for (var i = 0; i < data.Customizations.Count; ++i)
            {
                data.Customizations[i] = ReadCreateChrCustomizationChoice(packet, indexes, "Customizations", i);
            }
            return data;
        }

        public override ICorpseData ReadUpdateCorpseData(Packet packet, params object[] indexes)
        {
            var data = new CorpseData();
            var rawChangesMask = new int[1];
            var rawMaskMask = new int[1];
            rawMaskMask[0] = (int)packet.ReadBits(1);
            var maskMask = new BitArray(rawMaskMask);
            if (maskMask[0])
                rawChangesMask[0] = (int)packet.ReadBits(32);
            var changesMask = new BitArray(rawChangesMask);

            if (changesMask[0])
            {
                if (changesMask[1])
                {
                    data.Customizations.ReadUpdateMask(packet);
                }
            }
            packet.ResetBitReader();
            if (changesMask[0])
            {
                if (changesMask[1])
                {
                    for (var i = 0; i < data.Customizations.Count; ++i)
                    {
                        if (data.Customizations.UpdateMask[i])
                        {
                            data.Customizations[i] = ReadUpdateChrCustomizationChoice(packet, data.Customizations[i] as ChrCustomizationChoice, indexes, "Customizations", i);
                        }
                    }
                }
                if (changesMask[2])
                {
                    data.DynamicFlags = packet.ReadUInt32("DynamicFlags", indexes);
                }
                if (changesMask[3])
                {
                    data.Owner = packet.ReadPackedGuid128("Owner", indexes);
                }
                if (changesMask[4])
                {
                    data.PartyGUID = packet.ReadPackedGuid128("PartyGUID", indexes);
                }
                if (changesMask[5])
                {
                    data.GuildGUID = packet.ReadPackedGuid128("GuildGUID", indexes);
                }
                if (changesMask[6])
                {
                    data.DisplayID = packet.ReadUInt32("DisplayID", indexes);
                }
                if (changesMask[7])
                {
                    data.RaceID = packet.ReadByte("RaceID", indexes);
                }
                if (changesMask[8])
                {
                    data.Sex = packet.ReadByte("Sex", indexes);
                }
                if (changesMask[9])
                {
                    data.Class = packet.ReadByte("Class", indexes);
                }
                if (changesMask[10])
                {
                    data.Flags = packet.ReadUInt32("Flags", indexes);
                }
                if (changesMask[11])
                {
                    data.FactionTemplate = packet.ReadInt32("FactionTemplate", indexes);
                }
            }
            if (changesMask[12])
            {
                for (var i = 0; i < 19; ++i)
                {
                    if (changesMask[13 + i])
                    {
                        data.Items[i] = packet.ReadUInt32("Items", indexes, i);
                    }
                }
            }
            return data;
        }

        public static IScaleCurve ReadCreateScaleCurve(Packet packet, params object[] indexes)
        {
            var data = new ScaleCurve();
            packet.ResetBitReader();
            data.StartTimeOffset = packet.ReadUInt32("StartTimeOffset", indexes);
            for (var i = 0; i < 2; ++i)
            {
                data.Points[i] = packet.ReadVector2("Points", indexes, i);
            }
            data.ParameterCurve = packet.ReadUInt32("ParameterCurve", indexes);
            data.OverrideActive = packet.ReadBit("OverrideActive", indexes);
            return data;
        }

        public static IScaleCurve ReadUpdateScaleCurve(Packet packet, params object[] indexes)
        {
            var data = new ScaleCurve();
            packet.ResetBitReader();
            var rawChangesMask = new int[1];
            rawChangesMask[0] = (int)packet.ReadBits(7);
            var changesMask = new BitArray(rawChangesMask);

            if (changesMask[0])
            {
                if (changesMask[1])
                {
                    data.OverrideActive = packet.ReadBit("OverrideActive", indexes);
                }
            }
            packet.ResetBitReader();
            if (changesMask[0])
            {
                if (changesMask[2])
                {
                    data.StartTimeOffset = packet.ReadUInt32("StartTimeOffset", indexes);
                }
                if (changesMask[3])
                {
                    data.ParameterCurve = packet.ReadUInt32("ParameterCurve", indexes);
                }
            }
            if (changesMask[4])
            {
                for (var i = 0; i < 2; ++i)
                {
                    if (changesMask[5 + i])
                    {
                        data.Points[i] = packet.ReadVector2("Points", indexes, i);
                    }
                }
            }
            return data;
        }

        public static IVisualAnim ReadCreateVisualAnim(Packet packet, params object[] indexes)
        {
            var data = new VisualAnim();
            packet.ResetBitReader();
            data.AnimationDataID = packet.ReadUInt32("AnimationDataID", indexes);
            data.AnimKitID = packet.ReadUInt32("AnimKitID", indexes);
            data.AnimProgress = packet.ReadUInt32("AnimProgress", indexes);
            data.Field_C = packet.ReadBit("Field_C", indexes);
            return data;
        }

        public static IVisualAnim ReadUpdateVisualAnim(Packet packet, params object[] indexes)
        {
            var data = new VisualAnim();
            packet.ResetBitReader();
            var rawChangesMask = new int[1];
            rawChangesMask[0] = (int)packet.ReadBits(5);
            var changesMask = new BitArray(rawChangesMask);

            if (changesMask[0])
            {
                if (changesMask[1])
                {
                    data.Field_C = packet.ReadBit("Field_C", indexes);
                }
            }
            packet.ResetBitReader();
            if (changesMask[0])
            {
                if (changesMask[2])
                {
                    data.AnimationDataID = packet.ReadUInt32("AnimationDataID", indexes);
                }
                if (changesMask[3])
                {
                    data.AnimKitID = packet.ReadUInt32("AnimKitID", indexes);
                }
                if (changesMask[4])
                {
                    data.AnimProgress = packet.ReadUInt32("AnimProgress", indexes);
                }
            }
            return data;
        }

        public override IAreaTriggerData ReadCreateAreaTriggerData(Packet packet, UpdateFieldFlag flags, params object[] indexes)
        {
            var data = new AreaTriggerData();
            data.OverrideScaleCurve = ReadCreateScaleCurve(packet, indexes, "OverrideScaleCurve");
            data.Caster = packet.ReadPackedGuid128("Caster", indexes);
            data.Duration = packet.ReadUInt32("Duration", indexes);
            data.TimeToTarget = packet.ReadUInt32("TimeToTarget", indexes);
            data.TimeToTargetScale = packet.ReadUInt32("TimeToTargetScale", indexes);
            data.TimeToTargetExtraScale = packet.ReadUInt32("TimeToTargetExtraScale", indexes);
            data.SpellID = packet.ReadInt32("SpellID", indexes);
            data.SpellForVisuals = packet.ReadInt32("SpellForVisuals", indexes);
            data.SpellXSpellVisualID = packet.ReadInt32("SpellXSpellVisualID", indexes);
            data.BoundsRadius2D = packet.ReadSingle("BoundsRadius2D", indexes);
            data.DecalPropertiesID = packet.ReadUInt32("DecalPropertiesID", indexes);
            data.CreatingEffectGUID = packet.ReadPackedGuid128("CreatingEffectGUID", indexes);
            data.Field_80 = packet.ReadPackedGuid128("Field_80", indexes);
            data.ExtraScaleCurve = ReadCreateScaleCurve(packet, indexes, "ExtraScaleCurve");
            data.VisualAnim = ReadCreateVisualAnim(packet, indexes, "VisualAnim");
            return data;
        }

        public override IAreaTriggerData ReadUpdateAreaTriggerData(Packet packet, params object[] indexes)
        {
            var data = new AreaTriggerData();
            var rawChangesMask = new int[1];
            rawChangesMask[0] = (int)packet.ReadBits(16);
            var changesMask = new BitArray(rawChangesMask);

            packet.ResetBitReader();
            if (changesMask[0])
            {
                if (changesMask[1])
                {
                    data.OverrideScaleCurve = ReadUpdateScaleCurve(packet, data.OverrideScaleCurve as ScaleCurve, indexes, "OverrideScaleCurve");
                }
                if (changesMask[3])
                {
                    data.Caster = packet.ReadPackedGuid128("Caster", indexes);
                }
                if (changesMask[4])
                {
                    data.Duration = packet.ReadUInt32("Duration", indexes);
                }
                if (changesMask[5])
                {
                    data.TimeToTarget = packet.ReadUInt32("TimeToTarget", indexes);
                }
                if (changesMask[6])
                {
                    data.TimeToTargetScale = packet.ReadUInt32("TimeToTargetScale", indexes);
                }
                if (changesMask[7])
                {
                    data.TimeToTargetExtraScale = packet.ReadUInt32("TimeToTargetExtraScale", indexes);
                }
                if (changesMask[8])
                {
                    data.SpellID = packet.ReadInt32("SpellID", indexes);
                }
                if (changesMask[9])
                {
                    data.SpellForVisuals = packet.ReadInt32("SpellForVisuals", indexes);
                }
                if (changesMask[10])
                {
                    data.SpellXSpellVisualID = packet.ReadInt32("SpellXSpellVisualID", indexes);
                }
                if (changesMask[11])
                {
                    data.BoundsRadius2D = packet.ReadSingle("BoundsRadius2D", indexes);
                }
                if (changesMask[12])
                {
                    data.DecalPropertiesID = packet.ReadUInt32("DecalPropertiesID", indexes);
                }
                if (changesMask[13])
                {
                    data.CreatingEffectGUID = packet.ReadPackedGuid128("CreatingEffectGUID", indexes);
                }
                if (changesMask[14])
                {
                    data.Field_80 = packet.ReadPackedGuid128("Field_80", indexes);
                }
                if (changesMask[2])
                {
                    data.ExtraScaleCurve = ReadUpdateScaleCurve(packet, data.ExtraScaleCurve as ScaleCurve, indexes, "ExtraScaleCurve");
                }
                if (changesMask[15])
                {
                    data.VisualAnim = ReadUpdateVisualAnim(packet, data.VisualAnim as VisualAnim, indexes, "VisualAnim");
                }
            }
            return data;
        }

    }
}
